import{r as g,j as e,v as q,ak as B}from"./index-DrziBPhZ.js";import{N as D,t as E}from"./toast-ClnWKBBo.js";import{F as T,a as j}from"./FormItem-Cku4jOg1.js";import{B as A}from"./Button-DG2-jqZG.js";import{S as z}from"./StickyFooter-RWxGWKXo.js";import{F as P,a as V,b as w}from"./formik.esm-CPLrydYm.js";import{A as J}from"./index-CBDs7g4_.js";import{$}from"./index-Ds8t50Me.js";import{c as U,e as H,b as M,g as L,f as _}from"./index.esm-BB-UMuCJ.js";import"./Alert-BLGo7HyM.js";import"./index-yw21U4bP.js";import"./Badge-C2KmHilm.js";import{D as G}from"./index-BmalSfvl.js";import"./Card-nlnRLrlQ.js";import"./Skeleton-C2woZuKJ.js";import"./Dialog-D7FxUuyk.js";import"./Drawer-IABuvwPK.js";import"./index-8tDMqpHX.js";import"./useUniqueId-B25XPIVz.js";import{I as S}from"./Input-B4wHBRkW.js";import"./index-DKNJHN__.js";import"./index-ChB5CpHQ.js";import"./index-DN1w59Ps.js";import"./index-Cv7sYzj3.js";import"./ScrollBar-CAweRmRR.js";import"./Select-nm3Sb7o5.js";import"./Upload-DVKHQbcn.js";import"./index-BPwFYay9.js";import"./Tag-C5UAaR6R.js";import{A as R}from"./AdaptableCard-DmZKEZU8.js";import"./Views-D-uBkVS-.js";import"./chart.config-DDCNvm2Q.js";import"./DataTable-aN3aFI0i.js";import"./SvgIcon-BvWLwctQ.js";import"./SegmentItemOption-Cj0dKbLO.js";import{B as K,C as Q,D as W}from"./api-BL3Ea9lB.js";import"./StatusIcon-vuYtWMPB.js";import"./CloseButton-CSyekQus.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-MIyuRDz8.js";import"./context-B0dog8SG.js";import"./index-3lctU3d7.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-u5YpxD3p.js";import"./floating-ui.react-K4q-Qtxj.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-0JrmfMFZ.js";import"./_getPrototype-Dk_uG1mG.js";import"./index-CBr4D0uW.js";import"./toString-9EwY3KIP.js";import"./index-Csg7nRTo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-KN0VPQ3v.js";import"./index-GlPtBqgB.js";import"./useThemeClass-DpghVrlu.js";const X=new Date,O=g.forwardRef((d,n)=>{const{type:y,initialData:l={reportDate:new Date,description:"",amount:0,remarks:"",attachments:[]},onFormSubmit:N,onDiscard:u,onDelete:b}=d,[p,v]=g.useState(l.attachments||[]),F=U().shape({reportDate:_().required("Report date is required").typeError("Please select a valid date"),description:M().required("Description is required").max(200,"Description must be at most 200 characters"),amount:L().required("Amount is required").positive("Amount must be positive").typeError("Amount must be a number"),remarks:M().max(500,"Remarks must be at most 500 characters"),attachments:H().max(5,"Maximum 5 attachments allowed")}),m=c=>{if(c.target.files){const s=Array.from(c.target.files),r=[...p,...s];if(r.length>5){alert("Maximum 5 attachments allowed");return}v(r)}},a=c=>{const s=[...p];s.splice(c,1),v(s)};return e.jsx(P,{innerRef:n,initialValues:{reportDate:l.reportDate instanceof Date?l.reportDate:new Date(l.reportDate),description:l.description||"",amount:l.amount||"",remarks:l.remarks||"",attachments:[]},validationSchema:F,onSubmit:async(c,{setSubmitting:s,setErrors:r})=>{var h,i;try{const o={...c,attachments:p.filter(t=>t instanceof File)};await N(o,s)}catch(o){s(!1),(i=(h=o.response)==null?void 0:h.data)!=null&&i.errors&&r(o.response.data.errors),console.error("Form submission error:",o)}},enableReinitialize:!0,children:({values:c,touched:s,errors:r,isSubmitting:h,setFieldValue:i,handleBlur:o})=>e.jsx(V,{children:e.jsxs(T,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Expense Report Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(j,{label:"Report Date",invalid:!!r.reportDate&&s.reportDate,errorMessage:r.reportDate,children:e.jsx(w,{name:"reportDate",children:({field:t,form:x})=>e.jsx(G,{placeholder:"Select Report Date",value:t.value?new Date(t.value):null,maxDate:X,onChange:f=>x.setFieldValue(t.name,f||null)})})}),e.jsx(j,{label:"Amount",invalid:!!r.amount&&s.amount,errorMessage:r.amount,children:e.jsx(w,{name:"amount",children:({field:t,form:x})=>e.jsx(S,{type:"number",autoComplete:"off",placeholder:"Amount",...t,onChange:f=>{x.setFieldValue(t.name,f.target.value)}})})})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Details"}),e.jsx(j,{label:"Description",invalid:!!r.description&&s.description,errorMessage:r.description,children:e.jsx(w,{name:"description",children:({field:t})=>e.jsx(S,{autoComplete:"off",placeholder:"Enter description",...t})})}),e.jsx(j,{label:"Remarks",invalid:!!r.remarks&&s.remarks,errorMessage:r.remarks,children:e.jsx(w,{name:"remarks",children:({field:t})=>e.jsx(S,{as:"textarea",autoComplete:"off",placeholder:"Enter any remarks",...t})})})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Attachments"}),e.jsxs(j,{label:"Attachments",invalid:!!r.attachments&&s.attachments,errorMessage:r.attachments,children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"file",multiple:!0,onChange:m,onBlur:()=>o({target:{name:"attachments"}}),className:`block w-full text-sm text-gray-500\r
                                                file:mr-4 file:py-2 file:px-4\r
                                                file:rounded-md file:border-0\r
                                                file:text-sm file:font-semibold\r
                                                file:bg-blue-50 file:text-blue-700\r
                                                hover:file:bg-blue-100\r
                                                dark:file:bg-blue-900/30 dark:file:text-blue-300\r
                                                dark:hover:file:bg-blue-900/20`,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx"})}),p.length>0&&e.jsx("div",{className:"space-y-2",children:p.map((t,x)=>{const f=t instanceof File,C=f?t.name:t.fileName,I=f?void 0:t.filePath;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[I?e.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-300 truncate hover:underline",children:C}):e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:C}),e.jsx("button",{type:"button",onClick:()=>a(x),className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 ml-2",children:e.jsx($,{})})]},x)})})]})]})]})}),e.jsxs(z,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:y==="edit"&&b&&e.jsx(A,{size:"sm",variant:"plain",color:"red",icon:e.jsx($,{}),type:"button",onClick:()=>b(()=>{}),children:"Delete"})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>u==null?void 0:u(),children:"Discard"}),e.jsx(A,{size:"sm",variant:"solid",loading:h,icon:e.jsx(J,{}),type:"submit",children:"Save"})]})]})]})})})});O.displayName="ExpenseReportForm";const k={reportDate:new Date().toISOString().split("T")[0],amount:"",description:"",remarks:"",attachments:[]},et=()=>{const d=q(),{id:n}=B(),[y,l]=g.useState(k),[N,u]=g.useState(!!n),[b,p]=g.useState(null);g.useEffect(()=>{if(!n){l(k),u(!1);return}(async()=>{try{u(!0);const a=await K(n);if(!(a!=null&&a.data))throw new Error("Invalid report data received");l({reportDate:a.data.reportDate||k.reportDate,amount:a.data.amount||"",description:a.data.description||"",remarks:a.data.remarks||"",attachments:a.data.attachments||[]}),p(null)}catch(a){console.error("Error fetching expense report:",a),p(a.message||"Failed to load report data"),E.push(e.jsx(D,{title:"Failed to fetch expense report data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),setTimeout(()=>d("/app/expense-report-view"),2500)}finally{u(!1)}})()},[n,d]);const v=async(m,a)=>{var c,s,r,h;try{a(!0);const i=new FormData;i.append("reportType","expense"),Object.keys(m).forEach(t=>{t!=="attachments"&&i.append(t,m[t])}),m.attachments&&m.attachments.length>0&&m.attachments.forEach((t,x)=>{t instanceof File&&i.append("attachments",t)}),m.reportDate instanceof Date&&i.set("reportDate",m.reportDate.toISOString());const o=n?await Q(n,i):await W(i);if([200,201].includes(o.status))E.push(e.jsxs(D,{title:`Successfully ${n?"updated":"added"} expense report`,type:"success",duration:2500,children:["Expense report ",n?"updated":"added"," successfully"]}),{placement:"top-center"}),d("/app/expense-report-view");else throw new Error(((s=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:s.message)||"Unexpected status code")}catch(i){console.error("Error during form submission:",i),E.push(e.jsx(D,{title:`Error ${n?"updating":"adding"} expense report`,type:"danger",duration:2500,children:((h=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:h.message)||i.message}),{placement:"top-center"})}finally{a(!1)}},F=()=>{JSON.stringify(y)!==JSON.stringify(k)?window.confirm("Are you sure you want to discard changes?")&&d("/app/expense-report-view"):d("/app/expense-report-view")};return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):b?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(D,{title:"Error loading expense report",type:"danger",children:b})}):e.jsx(O,{type:n?"edit":"new",initialData:y,onFormSubmit:v,onDiscard:F})};export{et as default};
