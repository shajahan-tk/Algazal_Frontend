import{r as f,j as e,v as V,ak as ee}from"./index-B-3YdMmO.js";import{t as M,N as O}from"./toast-xjy4rp4Y.js";import{F as ae,a as p}from"./FormItem-B_dHMuui.js";import{B as A}from"./Button-CfVbO-qU.js";import{S as re}from"./StickyFooter-kVZ9pP5X.js";import{F as se,a as te,b,c as ie}from"./formik.esm-DIqlYRh2.js";import{$ as z,a0 as oe}from"./index-C7R1WpOH.js";import{A as ne}from"./index-of15F68n.js";import{c as me,b as I,g as le,e as pe}from"./index.esm-uYrHGYFJ.js";import"./Alert-QJLDMk5I.js";import"./index-Bo39LFtR.js";import"./Badge-B2PjptLi.js";import"./index-DCFjNNBJ.js";import"./Card-Dg6B2cp2.js";import"./Skeleton-C9LsrBBE.js";import"./Dialog-DSC5KQx1.js";import"./Drawer-CIBw5hlm.js";import"./index-DVAakj00.js";import"./useUniqueId-bhrNi0MA.js";import{I as x}from"./Input-m_H_R88b.js";import"./index-B_Yvn3dy.js";import"./index-Z4dDP0Pn.js";import"./index-BdrlLZgj.js";import"./index-5z68-iaN.js";import"./ScrollBar-C_iOIJGq.js";import{S as de}from"./Select-DPSULLBa.js";import{U as L}from"./Upload-CuAXzTtV.js";import"./index-CqQ94ycg.js";import"./Tag-D_vNYl-M.js";import{A as E}from"./AdaptableCard-17ILPCDG.js";import"./Views-o_SZwizf.js";import"./chart.config-Cux27phG.js";import{C as ce}from"./ConfirmDialog-xKOVDICi.js";import"./DataTable-CxfAxHEh.js";import"./SvgIcon-BC1C4FwK.js";import"./SegmentItemOption-CxYE_tKh.js";import{f as ue,e as ge,a as fe}from"./api-CnuQatZO.js";import"./StatusIcon-IxYTyNOx.js";import"./CloseButton-8arYtbYT.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-nPFZIZ0Z.js";import"./context-_TTgW2bZ.js";import"./index-Dhg3PmVb.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-VlwWE1Gk.js";import"./floating-ui.react-l_cC_yYr.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-HmMJSzbR.js";import"./_getPrototype-BJeMep-l.js";import"./index-BL9xzUQn.js";import"./toString-B2j7ZGf1.js";import"./index-CYY49BFP.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-BLqgq88H.js";import"./index-BYLbIXHY.js";import"./useThemeClass-BEUnEzZK.js";const _=[{label:"Admin",value:"admin"},{label:"Super Admin",value:"super_admin"},{label:"Engineer",value:"engineer"},{label:"Finance",value:"finance"},{label:"Driver",value:"driver"},{label:"Worker",value:"worker"},{label:"Supervisor",value:"supervisor"}],T=f.forwardRef((h,l)=>{const{type:g,initialData:n={firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",salary:0,accountNumber:"",emiratesId:"",emiratesIdDocument:"",passportNumber:"",passportDocument:""},onFormSubmit:D,onDiscard:S,onDelete:q}=h,[v,w]=f.useState(null),[o,F]=f.useState(null),[j,d]=f.useState(null),[P,$]=f.useState(null),[t,N]=f.useState({profileImage:n.profileImage||"",signatureImage:n.signatureImage||"",emiratesIdDocument:n.emiratesIdDocument||"",passportDocument:n.passportDocument||""});f.useEffect(()=>{N({profileImage:n.profileImage||"",signatureImage:n.signatureImage||"",emiratesIdDocument:n.emiratesIdDocument||"",passportDocument:n.passportDocument||""})},[n]);const H=me().shape({firstName:I().required("First Name Required"),lastName:I().required("Last Name Required"),email:I().email("Invalid email").required("Email Required"),role:I().required("Role is Required"),password:g==="new"?I().required("Password is Required"):I(),phoneNumbers:pe().of(I().matches(/^[0-9]+$/,"Phone number must be digits only")).min(1,"At least one phone number is required"),salary:le().min(0,"Salary cannot be negative").when("role",{is:r=>!["admin","super_admin"].includes(r),then:r=>r.required("Salary is required for this role"),otherwise:r=>r.notRequired()}),accountNumber:I(),emiratesId:I(),passportNumber:I()});return e.jsx(se,{innerRef:l,initialValues:{...n,phoneNumbers:Array.isArray(n.phoneNumbers)?n.phoneNumbers:typeof n.phoneNumbers=="string"?JSON.parse(n.phoneNumbers.replace(/'/g,'"')):[""],salary:n.salary||0},validationSchema:H,onSubmit:async(r,{setSubmitting:c,setErrors:i})=>{var U,k;const s=new FormData;s.append("firstName",r.firstName||""),s.append("lastName",r.lastName||""),s.append("email",r.email||""),s.append("role",r.role||""),r.password&&s.append("password",r.password);let m=r.phoneNumbers||[""];Array.isArray(m)||(m=[m]),s.append("phoneNumbers",JSON.stringify(m.filter(R=>R.trim().length>0))),r.role&&!["admin","super_admin"].includes(r.role)&&s.append("salary",((U=r.salary)==null?void 0:U.toString())||"0"),r.accountNumber&&s.append("accountNumber",r.accountNumber),r.emiratesId&&s.append("emiratesId",r.emiratesId),r.passportNumber&&s.append("passportNumber",r.passportNumber),v&&s.append("profileImage",v),o&&s.append("signatureImage",o),j&&s.append("emiratesIdDocument",j),P&&s.append("passportDocument",P),g==="edit"&&(!v&&t.profileImage&&s.append("profileImageUrl",t.profileImage),!o&&t.signatureImage&&s.append("signatureImageUrl",t.signatureImage),!j&&t.emiratesIdDocument&&s.append("emiratesIdDocumentUrl",t.emiratesIdDocument),!P&&t.passportDocument&&s.append("passportDocumentUrl",t.passportDocument),!r.profileImage&&t.profileImage&&s.append("removeProfileImage","true"),!r.signatureImage&&t.signatureImage&&s.append("removeSignatureImage","true"),!r.emiratesIdDocument&&t.emiratesIdDocument&&s.append("removeEmiratesIdDocument","true"),!r.passportDocument&&t.passportDocument&&s.append("removePassportDocument","true"));try{await D(s,c)}catch(R){c(!1),(k=R.message)!=null&&k.includes("Email already in use")&&i({email:"This email is already registered"})}},enableReinitialize:!0,children:({values:r,touched:c,errors:i,isSubmitting:s,setFieldValue:m})=>{const U=a=>{a.length>0?(w(a[0]),m("profileImage",a[0].name),N(u=>({...u,profileImage:""}))):(w(null),m("profileImage",t.profileImage||""))},k=a=>{a.length>0?(F(a[0]),m("signatureImage",a[0].name),N(u=>({...u,signatureImage:""}))):(F(null),m("signatureImage",t.signatureImage||""))},R=a=>{a.length>0?(d(a[0]),m("emiratesIdDocument",a[0].name),N(u=>({...u,emiratesIdDocument:""}))):(d(null),m("emiratesIdDocument",t.emiratesIdDocument||""))},J=a=>{a.length>0?($(a[0]),m("passportDocument",a[0].name),N(u=>({...u,passportDocument:""}))):($(null),m("passportDocument",t.passportDocument||""))},W=()=>{w(null),m("profileImage",""),N(a=>({...a,profileImage:""}))},G=()=>{F(null),m("signatureImage",""),N(a=>({...a,signatureImage:""}))},K=()=>{d(null),m("emiratesIdDocument",""),N(a=>({...a,emiratesIdDocument:""}))},Q=()=>{$(null),m("passportDocument",""),N(a=>({...a,passportDocument:""}))},X=!["admin","super_admin"].includes(r.role);return e.jsx(te,{children:e.jsxs(ae,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"First Name",invalid:!!(i.firstName&&c.firstName),errorMessage:i.firstName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:x})}),e.jsx(p,{label:"Last Name",invalid:!!(i.lastName&&c.lastName),errorMessage:i.lastName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:x})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Email",invalid:!!(i.email&&c.email),errorMessage:i.email,children:e.jsx(b,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:x})}),e.jsx(p,{label:"Role",invalid:!!(i.role&&c.role),errorMessage:i.role,children:e.jsx(b,{name:"role",children:({field:a,form:u})=>e.jsx(de,{placeholder:"Select Role",field:a,form:u,options:_,value:_.find(y=>y.value===r.role),onChange:y=>{u.setFieldValue(a.name,(y==null?void 0:y.value)||"")}})})})]}),X&&e.jsx(p,{label:"Salary",invalid:!!(i.salary&&c.salary),errorMessage:i.salary,children:e.jsx(b,{type:"number",autoComplete:"off",name:"salary",placeholder:"Salary",component:x,min:"0",step:"0.01"})})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Contact Information"}),e.jsx(ie,{name:"phoneNumbers",children:({push:a,remove:u})=>{var y;return e.jsxs("div",{className:"space-y-4",children:[(y=r.phoneNumbers)==null?void 0:y.map((Y,C)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end border-b pb-4",children:[e.jsx(p,{label:`Phone Number ${C+1}`,invalid:!!(i.phoneNumbers&&i.phoneNumbers[C]&&c.phoneNumbers),errorMessage:i.phoneNumbers&&i.phoneNumbers[C],children:e.jsx(b,{name:`phoneNumbers.${C}`,component:x,placeholder:"Phone Number",value:Y||"",onChange:Z=>{const B=[...r.phoneNumbers];B[C]=Z.target.value,m("phoneNumbers",B)}})}),e.jsx("div",{className:"flex justify-end",children:r.phoneNumbers.length>1&&e.jsx(A,{type:"button",size:"sm",variant:"plain",color:"red",icon:e.jsx(z,{}),onClick:()=>u(C)})})]},C)),e.jsx(A,{type:"button",size:"sm",variant:"twoTone",icon:e.jsx(oe,{}),onClick:()=>a(""),children:"Add Phone Number"})]})}}),e.jsx(p,{label:"Account Number",children:e.jsx(b,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Bank Account Number",component:x})})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID",children:e.jsx(b,{type:"text",autoComplete:"off",name:"emiratesId",placeholder:"Emirates ID Number",component:x})}),e.jsx(p,{label:"Passport Number",children:e.jsx(b,{type:"text",autoComplete:"off",name:"passportNumber",placeholder:"Passport Number",component:x})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID Document",children:e.jsx(L,{onChange:a=>R(a),onFileRemove:K,uploadLimit:1,defaultFile:t.emiratesIdDocument?[{name:"Emirates_ID_Document",url:t.emiratesIdDocument}]:[],fileList:j?[j]:[],accept:".pdf,.png,.jpeg,.jpg"})}),e.jsx(p,{label:"Passport Document",children:e.jsx(L,{onChange:a=>J(a),onFileRemove:Q,uploadLimit:1,defaultFile:t.passportDocument?[{name:"Passport_Document",url:t.passportDocument}]:[],fileList:P?[P]:[],accept:".pdf,.png,.jpeg,.jpg"})})]})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Profile Images"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Profile Image",invalid:!!(i.profileImage&&c.profileImage),errorMessage:i.profileImage,children:e.jsx(L,{onChange:a=>U(a),onFileRemove:W,uploadLimit:1,defaultFile:t.profileImage?[{name:"profile.jpg",url:t.profileImage}]:[],fileList:v?[v]:[],accept:"image/*"})}),e.jsx(p,{label:"Signature Image",invalid:!!(i.signatureImage&&c.signatureImage),errorMessage:i.signatureImage,children:e.jsx(L,{onChange:a=>k(a),onFileRemove:G,uploadLimit:1,defaultFile:t.signatureImage?[{name:"signature.jpg",url:t.signatureImage}]:[],fileList:o?[o]:[],accept:"image/*"})})]})]}),g==="new"&&e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Security"}),e.jsx(p,{label:"Password",invalid:!!(i.password&&c.password),errorMessage:i.password,children:e.jsx(b,{type:"password",autoComplete:"off",name:"password",placeholder:"Password",component:x})})]})]})}),e.jsxs(re,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:g==="edit"&&q&&e.jsx(he,{onDelete:q})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>S==null?void 0:S(),children:"Discard"}),e.jsx(A,{size:"sm",variant:"solid",loading:s,icon:e.jsx(ne,{}),type:"submit",children:"Save"})]})]})]})})}})});T.displayName="UserForm";const he=({onDelete:h})=>{const[l,g]=f.useState(!1),n=()=>{g(!1),h==null||h(g)},D=()=>{g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(z,{}),type:"button",onClick:()=>g(!0),children:"Delete"}),e.jsx(ce,{isOpen:l,type:"danger",title:"Delete user",confirmButtonColor:"red-600",onClose:D,onRequestClose:D,onCancel:D,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this user?"})})]})},xa=()=>{const h=V(),{id:l}=ee(),[g,n]=f.useState(null),[D,S]=f.useState(!!l);f.useEffect(()=>{l&&(async()=>{try{const o=await ue(l);console.log("response:",o),n({...o.data,phoneNumbers:o.data.phoneNumbers||[""],profileImage:o.data.profileImage||"",signatureImage:o.data.signatureImage||"",emiratesIdDocument:o.data.emiratesIdDocument||"",passportDocument:o.data.passportDocument||"",salary:o.data.salary||0}),S(!1)}catch(o){console.error("Error fetching user:",o),S(!1),M.push(e.jsx(O,{title:"Failed to fetch user data",type:"danger",duration:2500,children:o.message}),{placement:"top-center"}),h("/app/user-list")}})()},[l,h]);const q=async(w,o)=>{var F,j;o(!0);try{let d;if(l?d=await ge(l,w):d=await fe(w),d.status===(l?200:201))o(!1),M.push(e.jsxs(O,{title:`Successfully ${l?"updated":"added"} user`,type:"success",duration:2500,children:["User ",l?"updated":"added"," successfully"]}),{placement:"top-center"}),h("/app/user-list");else throw console.log(d),new Error(`Unexpected status code: ${d.response.data.message}`)}catch(d){console.error("Error during form submission:",d),o(!1),M.push(e.jsx(O,{title:`Error ${l?"updating":"adding"} user`,type:"danger",duration:2500,children:((j=(F=d.response)==null?void 0:F.data)==null?void 0:j.message)||d.message}),{placement:"top-center"})}},v=()=>{h("/app/user-list")};return D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(T,{type:l?"edit":"new",initialData:g||{firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",emiratesIdDocument:"",passportDocument:"",salary:0,accountNumber:"",emiratesId:"",passportNumber:""},onFormSubmit:q,onDiscard:v})};export{xa as default};
