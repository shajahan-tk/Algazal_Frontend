import{ak as D,v as B,r as a,b as k,j as e,a4 as E}from"./index-B-3YdMmO.js";import"./Alert-QJLDMk5I.js";import{A as P}from"./index-Bo39LFtR.js";import{B as _}from"./Badge-B2PjptLi.js";import{B as c}from"./Button-CfVbO-qU.js";import"./index-DCFjNNBJ.js";import{C as z}from"./Card-Dg6B2cp2.js";import"./Skeleton-C9LsrBBE.js";import"./Dialog-DSC5KQx1.js";import"./Drawer-CIBw5hlm.js";import"./index-DVAakj00.js";import"./FormItem-B_dHMuui.js";import"./useUniqueId-bhrNi0MA.js";import"./Input-m_H_R88b.js";import"./index-B_Yvn3dy.js";import"./index-Z4dDP0Pn.js";import{t as m,N as l}from"./toast-xjy4rp4Y.js";import"./index-BdrlLZgj.js";import"./index-5z68-iaN.js";import"./ScrollBar-C_iOIJGq.js";import"./Select-DPSULLBa.js";import"./Upload-CuAXzTtV.js";import"./index-CqQ94ycg.js";import"./Tag-D_vNYl-M.js";import{H,aj as W,Q as R}from"./index-C7R1WpOH.js";import{f as F,g as I}from"./api-CW8uBg2S.js";import{u as L}from"./useThemeClass-BEUnEzZK.js";import"./Views-o_SZwizf.js";import"./chart.config-Cux27phG.js";import"./DataTable-CxfAxHEh.js";import"./SvgIcon-BC1C4FwK.js";import"./SegmentItemOption-CxYE_tKh.js";import{F as O}from"./index-C3NLnlbc.js";import{M as T}from"./MarkAttendanceModal-DNp49gQX.js";import"./StatusIcon-IxYTyNOx.js";import"./CloseButton-8arYtbYT.js";import"./proxy-nPFZIZ0Z.js";import"./floating-ui.react-l_cC_yYr.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-Dhg3PmVb.js";import"./context-_TTgW2bZ.js";import"./useControllableState-HmMJSzbR.js";import"./_getPrototype-BJeMep-l.js";import"./index-BL9xzUQn.js";import"./toString-B2j7ZGf1.js";import"./chainedFunction-BxZSneMW.js";import"./index-CYY49BFP.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-VlwWE1Gk.js";import"./index-BLqgq88H.js";import"./index-BYLbIXHY.js";import"./cloneDeep-DJN0yfLA.js";const Te=()=>{const{projectId:r}=D();B(),L();const[b,p]=a.useState(!0),[x,h]=a.useState(!1),[i,M]=a.useState(null),[f,g]=a.useState([]),[A,w]=a.useState(k().format("DD MMM YYYY")),[S,n]=a.useState(!1),[u,j]=a.useState(null),y=async()=>{try{p(!0);const t=await F(r);M(t.data.data.project),g(t.data.data.workers),w(k(t.data.data.date).format("DD MMM YYYY"))}catch(t){m.push(e.jsx(l,{title:"Error fetching attendance",type:"danger",children:t.message}))}finally{p(!1)}};a.useEffect(()=>{y()},[r]);const N=async(t,s,Y)=>{try{h(!0),await I({projectId:r,userId:t,present:s,hour:Y}),g(o=>o.map(d=>d._id===t?{...d,present:s,markedBy:{_id:"current-user",firstName:"You",lastName:""},markedAt:new Date}:d)),m.push(e.jsx(l,{title:"Success",type:"success",children:"Attendance marked successfully"}))}catch(o){m.push(e.jsx(l,{title:"Error marking attendance",type:"danger",children:o.message}))}finally{h(!1),n(!1)}},C=t=>{j(t),n(!0)},v=()=>{j(null),n(!1)};return b?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(E,{})}):e.jsxs("div",{className:"container mx-auto px-4 h-full",children:[e.jsx(z,{header:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold mb-1",children:"Attendance Management"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[i==null?void 0:i.projectName," - ",A]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2 md:mt-0",children:e.jsx(c,{size:"sm",variant:"plain",icon:e.jsx(R,{}),onClick:y,children:"Refresh"})})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Worker"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:f.length>0?f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{size:"sm",src:t.profileImage,className:"mr-3",icon:e.jsx(O,{})}),e.jsx("div",{children:e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-200",children:[t.firstName," ",t.lastName]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:t.mobileNumber||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(_,{content:t.present?"Present":"Absent",innerClass:`${t.present?"bg-emerald-500 text-white":"bg-red-500 text-white"}`})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{size:"xs",variant:"solid",color:"green",icon:e.jsx(H,{}),onClick:()=>C(t._id),disabled:x||t.present,children:"Present"}),e.jsx(c,{size:"xs",variant:"solid",color:"red",icon:e.jsx(W,{}),onClick:()=>N(t._id,!1),disabled:x||!t.present,children:"Absent"})]})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No workers assigned to this project"})})})]})})}),e.jsx(T,{isOpen:S,onClose:v,onConfirm:(t,s)=>{u&&(N(u,!0,s),v())}})]})};export{Te as default};
