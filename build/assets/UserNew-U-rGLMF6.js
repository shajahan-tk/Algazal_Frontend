import{r as g,j as e,v as V,ak as ee}from"./index-CDUqAS1l.js";import{t as O,N as B}from"./toast-DGerJIJB.js";import{F as ae,a as p}from"./FormItem-ByEmqHQ5.js";import{B as A}from"./Button-BPBskG9o.js";import{S as re}from"./StickyFooter-DBlfAIlK.js";import{F as se,a as te,b,c as ie}from"./formik.esm-D7-nrDq7.js";import{$ as _,a0 as oe}from"./index-BerpkDBA.js";import{A as ne}from"./index-CwCYPHLJ.js";import{c as me,b as N,g as le,e as pe}from"./index.esm-OMRqgHjV.js";import"./Alert-DL8X4Uab.js";import"./index-C1Nx0TEh.js";import"./Badge-hMcflglf.js";import"./index-CRkWz9hY.js";import"./Card-Bb8Omztx.js";import"./Skeleton-DoyxclK2.js";import"./Dialog-C7AMlNhG.js";import"./Drawer-peSRAyXS.js";import"./index-DvFxqpjx.js";import"./useUniqueId-CQBDBfVD.js";import{I as x}from"./Input-DXBk0KXn.js";import"./index-Dk4smkVo.js";import"./index-cjDbE1Ce.js";import"./index-DQYmJabE.js";import"./index-ChKfPKLA.js";import"./ScrollBar-QR2Zwrhq.js";import{S as de}from"./Select-Bc7Wf5rB.js";import{U as L}from"./Upload-BJb1fzL_.js";import"./index-CocX0oO3.js";import"./Tag-Bq5dzNE2.js";import{A as R}from"./AdaptableCard-BXZ7gMWR.js";import"./Views-DmS3tele.js";import"./chart.config-CZuakYno.js";import{C as ce}from"./ConfirmDialog-C7odLSAF.js";import"./DataTable-CVcq30BR.js";import"./SvgIcon-DCpuHJM3.js";import"./SegmentItemOption-CD7-Nqsw.js";import{f as ue,e as ge,a as fe}from"./api-DtX_23JY.js";import"./StatusIcon-twe9Eqr7.js";import"./CloseButton-BXRa_ZJ2.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-Dk6QltiT.js";import"./context-D-kJGxG9.js";import"./index-CJy_8sJq.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-BmYztAKh.js";import"./floating-ui.react-CCBWD0pR.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-DyX12gyY.js";import"./_getPrototype-CIMlDKAv.js";import"./index-CjDcj2AV.js";import"./toString-DOI2nrr_.js";import"./index-DlSvysZf.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-CBdLSIrO.js";import"./index-B2bfEVVx.js";import"./useThemeClass-5GKJG2gx.js";const M=[{label:"Admin",value:"admin"},{label:"Super Admin",value:"super_admin"},{label:"Engineer",value:"engineer"},{label:"Finance",value:"finance"},{label:"Driver",value:"driver"},{label:"Worker",value:"worker"},{label:"Supervisor",value:"supervisor"}],T=g.forwardRef((f,l)=>{const{type:u,initialData:o={firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",salary:0,accountNumber:"",emiratesId:"",emiratesIdDocument:"",passportNumber:"",passportDocument:""},onFormSubmit:D,onDiscard:S,onDelete:q}=f,[v,w]=g.useState(null),[i,F]=g.useState(null),[j,d]=g.useState(null),[P,$]=g.useState(null),[t,I]=g.useState({profileImage:o.profileImage||"",signatureImage:o.signatureImage||"",emiratesIdDocument:o.emiratesIdDocument||"",passportDocument:o.passportDocument||""});g.useEffect(()=>{I({profileImage:o.profileImage||"",signatureImage:o.signatureImage||"",emiratesIdDocument:o.emiratesIdDocument||"",passportDocument:o.passportDocument||""})},[o]);const H=me().shape({firstName:N().required("First Name is required"),lastName:N().required("Last Name is required"),email:N().email("Invalid email").required("Email is required"),role:N().required("Role is required"),password:u==="new"?N().required("Password is required"):N(),phoneNumbers:pe().of(N().matches(/^[0-9]+$/,"Phone number must be digits only")).min(1,"At least one phone number is required"),salary:le().moreThan(0,"Salary must be greater than zero").when("role",{is:r=>!["admin","super_admin"].includes(r),then:r=>r.required("Salary is required for this role"),otherwise:r=>r.notRequired()}),accountNumber:N(),emiratesId:N(),passportNumber:N()});return e.jsx(se,{innerRef:l,initialValues:{...o,phoneNumbers:Array.isArray(o.phoneNumbers)?o.phoneNumbers:typeof o.phoneNumbers=="string"?JSON.parse(o.phoneNumbers.replace(/'/g,'"')):[""],salary:o.salary||0},validationSchema:H,onSubmit:async(r,{setSubmitting:h,setErrors:n})=>{var U,k;const s=new FormData;s.append("firstName",r.firstName||""),s.append("lastName",r.lastName||""),s.append("email",r.email||""),s.append("role",r.role||""),r.password&&s.append("password",r.password);let m=r.phoneNumbers||[""];Array.isArray(m)||(m=[m]),s.append("phoneNumbers",JSON.stringify(m.filter(E=>E.trim().length>0))),r.role&&!["admin","super_admin"].includes(r.role)&&s.append("salary",((U=r.salary)==null?void 0:U.toString())||"0"),r.accountNumber&&s.append("accountNumber",r.accountNumber),r.emiratesId&&s.append("emiratesId",r.emiratesId),r.passportNumber&&s.append("passportNumber",r.passportNumber),v&&s.append("profileImage",v),i&&s.append("signatureImage",i),j&&s.append("emiratesIdDocument",j),P&&s.append("passportDocument",P),u==="edit"&&(!v&&t.profileImage&&s.append("profileImageUrl",t.profileImage),!i&&t.signatureImage&&s.append("signatureImageUrl",t.signatureImage),!j&&t.emiratesIdDocument&&s.append("emiratesIdDocumentUrl",t.emiratesIdDocument),!P&&t.passportDocument&&s.append("passportDocumentUrl",t.passportDocument),!r.profileImage&&t.profileImage&&s.append("removeProfileImage","true"),!r.signatureImage&&t.signatureImage&&s.append("removeSignatureImage","true"),!r.emiratesIdDocument&&t.emiratesIdDocument&&s.append("removeEmiratesIdDocument","true"),!r.passportDocument&&t.passportDocument&&s.append("removePassportDocument","true"));try{await D(s,h)}catch(E){h(!1),(k=E.message)!=null&&k.includes("Email already in use")&&n({email:"This email is already registered"})}},enableReinitialize:!0,children:({values:r,touched:h,errors:n,isSubmitting:s,setFieldValue:m})=>{const U=a=>{a.length>0?(w(a[0]),m("profileImage",a[0].name),I(c=>({...c,profileImage:""}))):(w(null),m("profileImage",t.profileImage||""))},k=a=>{a.length>0?(F(a[0]),m("signatureImage",a[0].name),I(c=>({...c,signatureImage:""}))):(F(null),m("signatureImage",t.signatureImage||""))},E=a=>{a.length>0?(d(a[0]),m("emiratesIdDocument",a[0].name),I(c=>({...c,emiratesIdDocument:""}))):(d(null),m("emiratesIdDocument",t.emiratesIdDocument||""))},J=a=>{a.length>0?($(a[0]),m("passportDocument",a[0].name),I(c=>({...c,passportDocument:""}))):($(null),m("passportDocument",t.passportDocument||""))},W=()=>{w(null),m("profileImage",""),I(a=>({...a,profileImage:""}))},G=()=>{F(null),m("signatureImage",""),I(a=>({...a,signatureImage:""}))},K=()=>{d(null),m("emiratesIdDocument",""),I(a=>({...a,emiratesIdDocument:""}))},Q=()=>{$(null),m("passportDocument",""),I(a=>({...a,passportDocument:""}))},X=!["admin","super_admin"].includes(r.role);return e.jsx(te,{children:e.jsxs(ae,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"First Name",invalid:!!n.firstName&&h.firstName,errorMessage:n.firstName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"firstName",placeholder:"First Name",component:x})}),e.jsx(p,{label:"Last Name",invalid:!!n.lastName&&h.lastName,errorMessage:n.lastName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"lastName",placeholder:"Last Name",component:x})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Email",invalid:!!n.email&&h.email,errorMessage:n.email,children:e.jsx(b,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:x})}),e.jsx(p,{label:"Role",invalid:!!n.role&&h.role,errorMessage:n.role,children:e.jsx(b,{name:"role",children:({field:a,form:c})=>e.jsx(de,{placeholder:"Select Role",field:a,form:c,options:M,value:M.find(y=>y.value===r.role),onChange:y=>{c.setFieldValue(a.name,(y==null?void 0:y.value)||"")}})})})]}),X&&e.jsx(p,{label:"Salary",invalid:!!n.salary&&h.salary,errorMessage:n.salary,children:e.jsx(b,{type:"number",autoComplete:"off",name:"salary",placeholder:"Salary",component:x,min:"0",step:"0.01"})})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Contact Information"}),e.jsx(ie,{name:"phoneNumbers",children:({push:a,remove:c})=>{var y;return e.jsxs("div",{className:"space-y-4",children:[(y=r.phoneNumbers)==null?void 0:y.map((Y,C)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end border-b pb-4",children:[e.jsx(p,{label:`Phone Number ${C+1}`,invalid:!!(n.phoneNumbers&&n.phoneNumbers[C]&&h.phoneNumbers),errorMessage:n.phoneNumbers&&n.phoneNumbers[C],children:e.jsx(b,{name:`phoneNumbers.${C}`,component:x,placeholder:"Phone Number",value:Y||"",onChange:Z=>{const z=[...r.phoneNumbers];z[C]=Z.target.value,m("phoneNumbers",z)}})}),e.jsx("div",{className:"flex justify-end",children:r.phoneNumbers.length>1&&e.jsx(A,{type:"button",size:"sm",variant:"plain",color:"red",icon:e.jsx(_,{}),onClick:()=>c(C)})})]},C)),e.jsx(A,{type:"button",size:"sm",variant:"twoTone",icon:e.jsx(oe,{}),onClick:()=>a(""),children:"Add Phone Number"})]})}}),e.jsx(p,{label:"Account Number",children:e.jsx(b,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Bank Account Number",component:x})})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID",children:e.jsx(b,{type:"text",autoComplete:"off",name:"emiratesId",placeholder:"Emirates ID Number",component:x})}),e.jsx(p,{label:"Passport Number",children:e.jsx(b,{type:"text",autoComplete:"off",name:"passportNumber",placeholder:"Passport Number",component:x})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Emirates ID Document",children:e.jsx(L,{onChange:a=>E(a),onFileRemove:K,uploadLimit:1,defaultFile:t.emiratesIdDocument?[{name:"Emirates_ID_Document",url:t.emiratesIdDocument}]:[],fileList:j?[j]:[],accept:".pdf,.png,.jpeg,.jpg"})}),e.jsx(p,{label:"Passport Document",children:e.jsx(L,{onChange:a=>J(a),onFileRemove:Q,uploadLimit:1,defaultFile:t.passportDocument?[{name:"Passport_Document",url:t.passportDocument}]:[],fileList:P?[P]:[],accept:".pdf,.png,.jpeg,.jpg"})})]})]}),e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Profile Images"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Profile Image",children:e.jsx(L,{onChange:a=>U(a),onFileRemove:W,uploadLimit:1,defaultFile:t.profileImage?[{name:"profile.jpg",url:t.profileImage}]:[],fileList:v?[v]:[],accept:"image/*"})}),e.jsx(p,{label:"Signature Image",children:e.jsx(L,{onChange:a=>k(a),onFileRemove:G,uploadLimit:1,defaultFile:t.signatureImage?[{name:"signature.jpg",url:t.signatureImage}]:[],fileList:i?[i]:[],accept:"image/*"})})]})]}),u==="new"&&e.jsxs(R,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Security"}),e.jsx(p,{label:"Password",invalid:!!n.password&&h.password,errorMessage:n.password,children:e.jsx(b,{type:"password",autoComplete:"off",name:"password",placeholder:"Password",component:x})})]})]})}),e.jsxs(re,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:u==="edit"&&q&&e.jsx(he,{onDelete:q})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(A,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>S==null?void 0:S(),children:"Discard"}),e.jsx(A,{size:"sm",variant:"solid",loading:s,icon:e.jsx(ne,{}),type:"submit",children:"Save"})]})]})]})})}})});T.displayName="UserForm";const he=({onDelete:f})=>{const[l,u]=g.useState(!1),o=()=>{u(!1),f==null||f(u)},D=()=>{u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(_,{}),type:"button",onClick:()=>u(!0),children:"Delete"}),e.jsx(ce,{isOpen:l,type:"danger",title:"Delete user",confirmButtonColor:"red-600",onClose:D,onRequestClose:D,onCancel:D,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this user?"})})]})},xa=()=>{const f=V(),{id:l}=ee(),[u,o]=g.useState(null),[D,S]=g.useState(!!l);g.useEffect(()=>{l&&(async()=>{try{const i=await ue(l);console.log("response:",i),o({...i.data,phoneNumbers:i.data.phoneNumbers||[""],profileImage:i.data.profileImage||"",signatureImage:i.data.signatureImage||"",emiratesIdDocument:i.data.emiratesIdDocument||"",passportDocument:i.data.passportDocument||"",salary:i.data.salary||0}),S(!1)}catch(i){console.error("Error fetching user:",i),S(!1),O.push(e.jsx(B,{title:"Failed to fetch user data",type:"danger",duration:2500,children:i.message}),{placement:"top-center"}),f("/app/user-list")}})()},[l,f]);const q=async(w,i)=>{var F,j;i(!0);try{let d;if(l?d=await ge(l,w):d=await fe(w),d.status===(l?200:201))i(!1),O.push(e.jsxs(B,{title:`Successfully ${l?"updated":"added"} user`,type:"success",duration:2500,children:["User ",l?"updated":"added"," successfully"]}),{placement:"top-center"}),f("/app/user-list");else throw console.log(d),new Error(`Unexpected status code: ${d.response.data.message}`)}catch(d){console.error("Error during form submission:",d),i(!1),O.push(e.jsx(B,{title:`Error ${l?"updating":"adding"} user`,type:"danger",duration:2500,children:((j=(F=d.response)==null?void 0:F.data)==null?void 0:j.message)||d.message}),{placement:"top-center"})}},v=()=>{f("/app/user-list")};return D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(T,{type:l?"edit":"new",initialData:u||{firstName:"",lastName:"",email:"",phoneNumbers:[""],role:"",password:"",profileImage:"",signatureImage:"",emiratesIdDocument:"",passportDocument:"",salary:0,accountNumber:"",emiratesId:"",passportNumber:""},onFormSubmit:q,onDiscard:v})};export{xa as default};
