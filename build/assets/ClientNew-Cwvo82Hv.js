import{r as j,v as z,j as e,ak as X}from"./index-B-3YdMmO.js";import{a as Y,e as Z,c as _}from"./api-ByfTdXne.js";import{t as S,N as q}from"./toast-xjy4rp4Y.js";import{F as I,a as p}from"./FormItem-B_dHMuui.js";import{B as d}from"./Button-CfVbO-qU.js";import{S as ee}from"./StickyFooter-kVZ9pP5X.js";import{F as te,a as ae,b as m}from"./formik.esm-DIqlYRh2.js";import{a as M,b as D,A as re}from"./index-of15F68n.js";import{c as ie,b as u}from"./index.esm-uYrHGYFJ.js";import"./Alert-QJLDMk5I.js";import"./index-Bo39LFtR.js";import"./Badge-B2PjptLi.js";import"./index-DCFjNNBJ.js";import"./Card-Dg6B2cp2.js";import"./Skeleton-C9LsrBBE.js";import"./Dialog-DSC5KQx1.js";import"./Drawer-CIBw5hlm.js";import"./index-DVAakj00.js";import"./useUniqueId-bhrNi0MA.js";import{I as c}from"./Input-m_H_R88b.js";import"./index-B_Yvn3dy.js";import"./index-Z4dDP0Pn.js";import"./index-BdrlLZgj.js";import"./index-5z68-iaN.js";import"./ScrollBar-C_iOIJGq.js";import"./Select-DPSULLBa.js";import"./Upload-CuAXzTtV.js";import"./index-CqQ94ycg.js";import"./Tag-D_vNYl-M.js";import{A as R}from"./AdaptableCard-17ILPCDG.js";import"./Views-o_SZwizf.js";import"./chart.config-Cux27phG.js";import{ab as $,ac as B,ad as se}from"./index-C7R1WpOH.js";import"./DataTable-CxfAxHEh.js";import"./SvgIcon-BC1C4FwK.js";import"./SegmentItemOption-CxYE_tKh.js";import"./StatusIcon-IxYTyNOx.js";import"./CloseButton-8arYtbYT.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-nPFZIZ0Z.js";import"./context-_TTgW2bZ.js";import"./index-Dhg3PmVb.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-VlwWE1Gk.js";import"./floating-ui.react-l_cC_yYr.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-HmMJSzbR.js";import"./_getPrototype-BJeMep-l.js";import"./index-BL9xzUQn.js";import"./toString-B2j7ZGf1.js";import"./index-CYY49BFP.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-BLqgq88H.js";import"./index-BYLbIXHY.js";import"./useThemeClass-BEUnEzZK.js";const O=ie().shape({clientName:u().required("Client Name Required"),email:u().required("Email Required").email("Invalid email format"),clientAddress:u().required("Client Address Required"),pincode:u().required("Pincode Required").matches(/^[0-9]+$/,"Pincode must be numeric").min(6).max(6),mobileNumber:u().required("Mobile Number Required").matches(/^[0-9]+$/,"Mobile number must be digits only"),telephoneNumber:u().matches(/^[0-9]+$/,"Telephone number must be digits only").nullable(),trnNumber:u().required("TRN Number Required"),accountNumber:u().required("Account Number Required")}),E=j.forwardRef((g,o)=>{const v=z(),{type:C,initialData:x={clientName:"",email:"",clientAddress:"",pincode:"",mobileNumber:"",telephoneNumber:null,trnNumber:"",accountNumber:"",locations:[]},onFormSubmit:k,onDiscard:w,onDelete:A}=g,[i,s]=j.useState(x.locations||[]),h=r=>{const a={};return r.inner.forEach(t=>{a[t.path]=t.message}),a},T=()=>{s([...i,{name:"",buildings:[]}])},P=r=>{const a=[...i];a.splice(r,1),s(a)},H=r=>{const a=[...i];a[r].buildings.push({name:"",apartments:[]}),s(a)},J=(r,a)=>{const t=[...i];t[r].buildings.splice(a,1),s(t)},V=(r,a)=>{const t=[...i];t[r].buildings[a].apartments.push({number:""}),s(t)},G=(r,a,t)=>{const n=[...i];n[r].buildings[a].apartments.splice(t,1),s(n)},K=(r,a)=>{const t=[...i];t[r].name=a,s(t)},Q=(r,a,t)=>{const n=[...i];n[r].buildings[a].name=t,s(n)},U=(r,a,t,n)=>{const b=[...i];b[r].buildings[a].apartments[t].number=n,s(b)};return e.jsx(te,{innerRef:o,initialValues:{...x,locations:i},validationSchema:O,onSubmit:async(r,{setSubmitting:a})=>{try{const t={...r,locations:i.map(b=>({name:b.name,buildings:b.buildings.map(N=>({name:N.name,apartments:N.apartments.map(l=>({number:l.number}))}))}))};console.log("Form data to be submitted:",JSON.stringify(t,null,2));const n=await k(t,a);n!=null&&n.id?v(`/client-view/${n.id}`):C==="edit"&&x.id&&v(`/client-view/${x.id}`)}catch(t){console.error("Form submission error:",t)}},validateOnBlur:!0,validateOnChange:!1,validate:r=>{try{return O.validateSync(r,{abortEarly:!1}),{}}catch(a){return h(a)}},children:({values:r,touched:a,errors:t,isSubmitting:n,handleSubmit:b})=>e.jsx(ae,{onSubmit:b,children:e.jsxs(I,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(R,{className:"mb-4",children:[e.jsx("h3",{className:"mb-6 text-lg font-semibold",children:"Client Information"}),e.jsx(p,{label:"Client Name",invalid:!!(t.clientName&&a.clientName),errorMessage:t.clientName,children:e.jsx(m,{type:"text",autoComplete:"off",name:"clientName",placeholder:"Client Name",component:c})}),e.jsx(p,{label:"Email",invalid:!!(t.email&&a.email),errorMessage:t.email,children:e.jsx(m,{type:"text",autoComplete:"off",name:"email",placeholder:"Email",component:c})}),e.jsx(p,{label:"Client Address",invalid:!!(t.clientAddress&&a.clientAddress),errorMessage:t.clientAddress,children:e.jsx(m,{as:"textarea",autoComplete:"off",name:"clientAddress",placeholder:"Client Address",component:c,textArea:!0})}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Pincode",invalid:!!(t.pincode&&a.pincode),errorMessage:t.pincode,children:e.jsx(m,{type:"text",autoComplete:"off",name:"pincode",placeholder:"Pincode",component:c})}),e.jsx(p,{label:"TRN Number",invalid:!!(t.trnNumber&&a.trnNumber),errorMessage:t.trnNumber,children:e.jsx(m,{type:"text",autoComplete:"off",name:"trnNumber",placeholder:"TRN Number",component:c})}),e.jsx(p,{label:"Account Number",invalid:!!(t.accountNumber&&a.accountNumber),errorMessage:t.accountNumber,children:e.jsx(m,{type:"text",autoComplete:"off",name:"accountNumber",placeholder:"Account Number",component:c})})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Mobile Number",invalid:!!(t.mobileNumber&&a.mobileNumber),errorMessage:t.mobileNumber,children:e.jsx(m,{type:"text",autoComplete:"off",name:"mobileNumber",placeholder:"Mobile Number",component:c})}),e.jsx(p,{label:"Telephone Number",invalid:!!(t.telephoneNumber&&a.telephoneNumber),errorMessage:t.telephoneNumber,children:e.jsx(m,{type:"text",autoComplete:"off",name:"telephoneNumber",placeholder:"Telephone Number",component:c})})]})]})})}),e.jsxs(R,{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx($,{className:"mr-2 text-xl"}),"Location - Building - Apartment Structure"]}),e.jsx(d,{size:"sm",variant:"solid",icon:e.jsx(M,{}),onClick:T,type:"button",children:"Add Location"})]}),i.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(B,{className:"mx-auto text-4xl mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{children:"No locations added yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Add Location" to get started'})]}),e.jsx("div",{className:"space-y-4",children:i.map((N,l)=>e.jsxs("div",{className:"border rounded-lg dark:border-gray-600 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center p-4 border-b dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50 rounded-t-lg",children:[e.jsx($,{className:"mr-2 text-lg text-gray-500 dark:text-gray-400"}),e.jsx(m,{type:"text",autoComplete:"off",value:N.name,onChange:f=>K(l,f.target.value),placeholder:"Location Name",component:c,className:"flex-grow mr-2 bg-transparent px-0"}),e.jsx(d,{size:"xs",variant:"plain",color:"red",icon:e.jsx(D,{}),onClick:()=>P(l),className:"hover:bg-gray-200 dark:hover:bg-gray-600",type:"button"})]}),e.jsxs("div",{className:"p-4",children:[N.buildings.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm bg-gray-50 dark:bg-gray-700/30 rounded mb-4",children:"No buildings in this location"}),e.jsx("div",{className:"space-y-3",children:N.buildings.map((f,y)=>e.jsxs("div",{className:"border rounded dark:border-gray-600 bg-gray-50 dark:bg-gray-700/30",children:[e.jsxs("div",{className:"flex items-center p-3 border-b dark:border-gray-600 bg-white dark:bg-gray-800/50 rounded-t",children:[e.jsx(B,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx(m,{type:"text",autoComplete:"off",value:f.name,onChange:L=>Q(l,y,L.target.value),placeholder:"Building Name",component:c,className:"flex-grow mr-2 bg-transparent px-0"}),e.jsx(d,{size:"xs",variant:"plain",color:"red",icon:e.jsx(D,{}),onClick:()=>J(l,y),className:"hover:bg-gray-200 dark:hover:bg-gray-600",type:"button"})]}),e.jsxs("div",{className:"p-3",children:[f.apartments.length===0&&e.jsx("div",{className:"text-center py-3 text-gray-500 dark:text-gray-400 text-xs bg-white dark:bg-gray-800/30 rounded mb-2",children:"No apartments in this building"}),e.jsx("div",{className:"space-y-2",children:f.apartments.map((L,F)=>e.jsxs("div",{className:"flex items-center p-2 bg-white dark:bg-gray-800 rounded border dark:border-gray-600",children:[e.jsx(se,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx(m,{type:"text",autoComplete:"off",value:L.number,onChange:W=>U(l,y,F,W.target.value),placeholder:"Apartment Number",component:c,className:"flex-grow mr-2"}),e.jsx(d,{size:"xs",variant:"plain",color:"red",icon:e.jsx(D,{}),onClick:()=>G(l,y,F),className:"hover:bg-gray-200 dark:hover:bg-gray-600",type:"button"})]},`apartment-${F}`))}),e.jsx(d,{size:"xs",variant:"plain",icon:e.jsx(M,{}),onClick:()=>V(l,y),className:"mt-2 w-full justify-center",type:"button",children:"Add Apartment"})]})]},`building-${y}`))}),e.jsx(d,{size:"xs",variant:"plain",icon:e.jsx(M,{}),onClick:()=>H(l),className:"mt-3 w-full justify-center",type:"button",children:"Add Building"})]})]},`location-${l}`))})]}),e.jsxs(ee,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:C==="edit"&&A&&e.jsx(d,{size:"sm",variant:"solid",color:"red",type:"button",onClick:A,children:"Delete"})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(d,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:w,children:"Discard"}),e.jsx(d,{size:"sm",variant:"solid",loading:n,disabled:n,icon:e.jsx(re,{}),type:"submit",children:"Save"})]})]})]})})})});E.displayName="ClientForm";const lt=()=>{const g=z(),{id:o}=X(),[v,C]=j.useState(null),[x,k]=j.useState(!!o);j.useEffect(()=>{o&&(async()=>{try{const s=await Y(o);C(s.data),k(!1)}catch{k(!1),S.push(e.jsx(q,{title:"Failed to fetch client data",type:"danger"}),{placement:"top-center"}),g(-1)}})()},[o,g]);const w=async(i,s)=>{s(!0);try{let h;o?h=await Z(o,i):h=await _(i),h.status===(o?200:201)&&(S.push(e.jsx(q,{title:`Successfully ${o?"updated":"created"} client`,type:"success"}),{placement:"top-center"}),g(-1))}catch{S.push(e.jsx(q,{title:`Failed to ${o?"update":"create"} client`,type:"danger"}),{placement:"top-center"})}finally{s(!1)}},A=()=>{g("/app/client-list")};return x?e.jsx("div",{children:"Loading client data..."}):e.jsx(E,{type:o?"edit":"new",initialData:v||{clientName:"",clientAddress:"",pincode:"",mobileNumber:"",telephoneNumber:null,trnNumber:"",accountNumber:""},onFormSubmit:w,onDiscard:A})};export{lt as default};
