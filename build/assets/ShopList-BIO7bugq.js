import{j as e,m as A,r as n,v as T}from"./index-CDUqAS1l.js";import{A as K}from"./AdaptableCard-BXZ7gMWR.js";import{B as I}from"./Button-BPBskG9o.js";import{_ as O,O as E,W as $,$ as M}from"./index-BerpkDBA.js";import{D as P}from"./DataTable-CVcq30BR.js";import{u as B}from"./useThemeClass-5GKJG2gx.js";import{u as H}from"./useQuery-Bhl94K2J.js";import{d as R}from"./debounce-D6G_2h-R.js";import{I as _}from"./Input-DXBk0KXn.js";import{d as q,f as F}from"./api-CXJtiSoD.js";import{h as L}from"./moment-C5S46NFB.js";import{C as z}from"./ConfirmDialog-C7odLSAF.js";import{t as j,N as b}from"./toast-DGerJIJB.js";import"./Card-Bb8Omztx.js";import"./context-D-kJGxG9.js";import"./index-CocX0oO3.js";import"./index-CBdLSIrO.js";import"./Skeleton-DoyxclK2.js";import"./Views-DmS3tele.js";import"./_getPrototype-CIMlDKAv.js";import"./Select-Bc7Wf5rB.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-BmYztAKh.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-B2bfEVVx.js";import"./toString-DOI2nrr_.js";import"./index-C1Nx0TEh.js";import"./floating-ui.react-CCBWD0pR.js";import"./index-CJy_8sJq.js";import"./proxy-Dk6QltiT.js";import"./Dialog-C7AMlNhG.js";import"./index-CjDcj2AV.js";import"./CloseButton-BXRa_ZJ2.js";import"./StatusIcon-twe9Eqr7.js";import"./chainedFunction-BxZSneMW.js";const Y=()=>e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:e.jsx(A,{className:"block lg:inline-block md:mb-0 mb-4",to:"/app/new-shop",children:e.jsx(I,{block:!0,variant:"solid",size:"sm",icon:e.jsx(O,{}),children:"Add Shops"})})}),Q=({isOpen:r,onClose:a,shopId:i,shopName:t,refetch:c})=>{const[m,p]=n.useState(!1);if(!r||!i)return null;const u=async()=>{var d,o;p(!0);try{await q(i),c(),j.push(e.jsx(b,{title:"Shop deleted",type:"success",duration:2500,children:"The shop has been successfully deleted."}),{placement:"top-center"}),a()}catch(l){console.error("Delete failed:",l),j.push(e.jsx(b,{title:"Failed to delete shop",type:"danger",duration:2500,children:((o=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:o.message)||l.message||"Something went wrong"}),{placement:"top-center"})}finally{p(!1)}};return e.jsxs(z,{isOpen:r,type:"danger",title:"Delete Shop",confirmButtonColor:"red-600",onClose:a,onRequestClose:a,onCancel:a,onConfirm:u,confirmButtonDisabled:m,children:[e.jsxs("p",{children:["Are you sure you want to delete",t?` the shop "${t}"`:" this shop","? This action cannot be undone."]}),m&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},V=({row:r,onDeleteClick:a})=>{const{textTheme:i}=B(),t=T();return e.jsxs("div",{className:"flex justify-end text-lg",children:[e.jsx("span",{className:`cursor-pointer p-2 hover:${i}`,onClick:()=>t(`/app/shop-details/${r._id}`),children:e.jsx(E,{})}),e.jsx("span",{className:`cursor-pointer p-2 hover:${i}`,onClick:()=>t(`/app/new-shop/${r._id}`),children:e.jsx($,{})}),e.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>a(r._id),children:e.jsx(M,{})})]})},W=()=>{var x,f;const r=n.useRef(null),[a,i]=n.useState(""),[t,c]=n.useState({page:1,limit:10}),[m,p]=n.useState(!1),[u,d]=n.useState(null),{data:o,isLoading:l,error:G,refetch:y}=H({queryKey:["shops",t.page,t.limit,a],queryFn:()=>F({page:t.page,limit:t.limit,search:a})}),S=((x=o==null?void 0:o.data)==null?void 0:x.shops)||[],g=((f=o==null?void 0:o.data)==null?void 0:f.pagination)||{total:0,page:1,limit:10},N=n.useMemo(()=>R(s=>{i(s),c(h=>({...h,page:1}))},500),[]),w=s=>{N(s.target.value)},C=s=>{d(s),p(!0)},v=n.useMemo(()=>[{header:"Name",accessorKey:"shopName",cell:s=>e.jsx("span",{children:s.row.original.shopName})},{header:"Number",accessorKey:"shopNo",cell:s=>e.jsx("span",{children:s.row.original.shopNo})},{header:"Address",accessorKey:"address",cell:s=>e.jsx("span",{children:s.row.original.address})},{header:"VAT",accessorKey:"vat",cell:s=>e.jsx("span",{children:s.row.original.vat})},{header:"Owner",accessorKey:"ownerName",cell:s=>e.jsx("span",{children:s.row.original.ownerName})},{header:"Email",accessorKey:"ownerEmail",cell:s=>e.jsx("span",{children:s.row.original.ownerEmail})},{header:"Contact",accessorKey:"contact",cell:s=>e.jsx("span",{children:s.row.original.contact})},{header:"Date",accessorKey:"createdAt",cell:s=>e.jsx("span",{children:L(s.row.original.createdAt).format("DD MMM YY")})},{header:"Action",id:"action",cell:s=>e.jsx(V,{row:s.row.original,onDeleteClick:C})}],[]),D=s=>{c(h=>({...h,page:s}))},k=s=>{c(h=>({page:1,limit:s}))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(_,{placeholder:"Search shops...",onChange:w,className:"max-w-md"})}),e.jsx(P,{ref:r,columns:v,data:S,skeletonAvatarColumns:[0,3,4],skeletonAvatarProps:{className:"rounded-md"},loading:l,pagingData:{total:g.total,pageIndex:g.page,pageSize:g.limit},onPaginationChange:D,onSelectChange:k}),e.jsx(Q,{isOpen:m,onClose:()=>p(!1),shopId:u,refetch:y})]})},Oe=()=>e.jsxs(K,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Shops "}),e.jsx(Y,{})]}),e.jsx(W,{})]});export{Oe as default};
