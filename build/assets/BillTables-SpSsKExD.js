import{Y as ae,r as n,j as s,b as f,v as se}from"./index-CfFwh--H.js";import{D as le}from"./DataTable-B06t5ZtT.js";import{Q as re,aU as oe,O as te,W as ne,$ as ie}from"./index-CEOENyZN.js";import{u as ce}from"./useThemeClass-Rhgp5cBq.js";import{u as he}from"./useQuery-B-q1oy2W.js";import{d as de}from"./debounce-C6Vtcf0t.js";import{I as me}from"./Input-CT3ndZ0a.js";import{B as pe}from"./Badge-Bo_BJ3HY.js";import{e as ue,b as ge}from"./api-BL2eMQch.js";import{h as xe}from"./moment-C5S46NFB.js";import{a as be,b as ye}from"./BillTableTools-CyMsY-Pt.js";import{b as Ne}from"./index-h6pWLCgn.js";import{F as ve}from"./FileSaver.min-XukS3WxJ.js";const O={adcb:{label:"ADCB",dotClass:"bg-blue-500",textClass:"text-blue-500"},adib:{label:"ADIB",dotClass:"bg-green-500",textClass:"text-green-500"},cash:{label:"Cash",dotClass:"bg-purple-500",textClass:"text-purple-500"},masherq_card:{label:"MASHREQ CARD",dotClass:"bg-orange-500",textClass:"text-orange-500"}},v=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],fe=Array.from({length:10},(m,g)=>({value:f().year()-5+g,label:(f().year()-5+g).toString()})),Te=({onDropdownSelect:m})=>{var R,E,B;const d=ae().pathname,[x,j]=n.useState(!1),w=n.useRef(null),[b,A]=n.useState(""),[c,p]=n.useState({page:1,limit:10}),[o,C]=n.useState({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""}),[T,D]=n.useState(!1),[Y,I]=n.useState(null),[$,k]=n.useState(!1),[h,K]=n.useState(new Date().getMonth()+1),[u,M]=n.useState(new Date().getFullYear()),t=d.includes("/fuel-bill-view")?"fuel":d.includes("/mess-bill-view")?"mess":d.includes("/vehicle-bill-view")?"vehicle":d.includes("/acc-bill-view")?"accommodation":d.includes("/commission-bill-view")?"commission":"general",P=a=>{C(a)},{data:i,isLoading:_,error:S,refetch:z}=he({queryKey:["bills",c.page,c.limit,b,o,t,h,u],queryFn:()=>ge({page:c.page,limit:c.limit,billType:t,search:b,month:h,year:u,startDate:o.startDate,endDate:o.endDate,category:o.category,shop:o.shop,vehicle:o.vehicleNo,paymentMethod:o.paymentMethod})}),H=((R=i==null?void 0:i.data)==null?void 0:R.bills)||[],q=((E=i==null?void 0:i.data)==null?void 0:E.totalAmount)||0,y=((B=i==null?void 0:i.data)==null?void 0:B.pagination)||{total:0,page:1,limit:10},L=n.useMemo(()=>de(a=>{A(a),p(e=>({...e,page:1}))},500),[]),J=a=>{L(a.target.value)},Q=({row:a,onDeleteClick:e})=>{const{textTheme:l}=ce(),r=se(),N={general:"/app/new-gen-bill",mess:"/app/new-mess-bill",fuel:"/app/new-fuel-bill",vehicle:"/app/new-vehicle-bill",accommodation:"/app/new-acc-bill",commission:"/app/new-commission-bill"};return s.jsxs("div",{className:"flex text-lg",children:[s.jsx("span",{className:`cursor-pointer p-2 hover:${l}`,onClick:()=>r("/app/bill-attachments",{state:{data:a==null?void 0:a.attachments}}),children:s.jsx(te,{})}),s.jsx("span",{className:`cursor-pointer p-2 hover:${l}`,onClick:()=>r(`${N[t]}/${a._id}`),children:s.jsx(ne,{})}),s.jsx("span",{className:"cursor-pointer p-2 hover:text-red-500",onClick:()=>e(a),children:s.jsx(ie,{})})]})},V=()=>{const a=[{header:"S.NO",accessorKey:"_id",cell:e=>s.jsx("span",{children:e.row.index+1})},{header:"DATE",accessorKey:"billDate",cell:e=>s.jsx("span",{children:xe(e.row.original.billDate).format("DD MMM YYYY")})},{header:"Payment Method",accessorKey:"paymentMethod",cell:e=>{const l=e.row.original.paymentMethod,r=O[l]||{label:l,dotClass:"bg-gray-500",textClass:"text-gray-500"};return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(pe,{className:r.dotClass}),s.jsx("span",{className:`capitalize font-semibold ${r.textClass}`,children:r.label})]})}},{header:"Amount",accessorKey:"amount",cell:e=>s.jsxs("span",{children:[" ",e.row.original.amount.toFixed(2)]})},{header:"Action",id:"action",cell:e=>s.jsx(Q,{row:e.row.original,onDeleteClick:l=>{I(l),D(!0)}})}];return t==="mess"?[a[0],a[1],{header:"Shop Name",accessorKey:"shop",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:e=>s.jsx("span",{children:e.row.original.invoiceNo||"N/A"})},a[2],a[3],a[4]]:t==="general"?[a[0],a[1],{header:"Category",accessorKey:"category",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.category)==null?void 0:l.name)||"N/A"})}},{header:"Shop Name",accessorKey:"shop",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Shop Number",accessorKey:"shopNo",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:e=>s.jsx("span",{children:e.row.original.invoiceNo||"N/A"})},a[2],a[3],{header:"REMARK",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},a[4]]:t==="fuel"?[a[0],a[1],{header:"Description",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.vehicle)==null?void 0:l.vehicleNumber)||"N/A"})}},a[2],a[3],{header:"Kilometer",accessorKey:"kilometer",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.kilometer)==null?void 0:l.toFixed(2))||"N/A"})}},{header:"Liter",accessorKey:"liter",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.liter)==null?void 0:l.toFixed(2))||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},a[4]]:t==="vehicle"?[a[0],a[1],{header:"Purpose Of Use",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},{header:"Vehicle No",accessorKey:"vehicle",cell:e=>{const l=e.row.original.vehicle;return Array.isArray(l)?s.jsx("span",{children:l.map(r=>r.vehicleNumber).join(", ")||"N/A"}):l?s.jsx("span",{children:l.vehicleNumber||"N/A"}):s.jsx("span",{children:"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:e=>s.jsx("span",{children:e.row.original.invoiceNo||"N/A"})},a[2],a[3],{header:"Shop Name",accessorKey:"shop",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Remarks",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},a[4]]:t==="accommodation"?[a[0],a[1],{header:"Company Name",accessorKey:"shop",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original.shop)==null?void 0:l.shopName)||"N/A"})}},{header:"Room No",accessorKey:"accommodation",cell:e=>{var l;return s.jsx("span",{children:((l=e.row.original)==null?void 0:l.roomNo)||"N/A"})}},{header:"Invoice No",accessorKey:"invoiceNo",cell:e=>s.jsx("span",{children:e.row.original.invoiceNo||"N/A"})},{header:"Payment Mode",accessorKey:"paymentMethod",cell:e=>{const l=e.row.original.paymentMethod,r=O[l]||{label:l,textClass:"text-gray-500"};return s.jsx("span",{className:`capitalize font-semibold ${r.textClass}`,children:r.label})}},a[3],{header:"Note",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},{header:"Remarks",accessorKey:"remarks",cell:e=>s.jsx("span",{children:e.row.original.remarks||"N/A"})},a[4]]:t==="commission"?[a[0],a[1],a[3],a[4]]:a},U=n.useMemo(()=>V(),[t]),W=a=>{p(e=>({...e,page:a}))},G=a=>{p(e=>({page:1,limit:a}))},X=()=>{k(!0)},F=a=>{console.log("onDrawerClose",a),k(!1)},Z=()=>{var a,e;C({startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:""}),A(""),K(new Date().getMonth()+1),M(new Date().getFullYear()),p({page:1,limit:10}),(e=(a=w.current)==null?void 0:a.resetSorting)==null||e.call(a)},ee=async()=>{j(!0);try{const a=await ue({page:c.page,limit:c.limit,search:b,billType:t,month:h,year:u,startDate:o.startDate,endDate:o.endDate,category:o.category,shop:o.shop,vehicle:o.vehicleNo,paymentMethod:o.paymentMethod}),e=`bills_${t}_${f().format("YYYY-MM-DD")}.xlsx`;ve.saveAs(a,e)}catch(a){console.error("Error exporting bills:",a)}finally{j(!1)}};return n.useEffect(()=>{var e;const a=((e=v.find(l=>l.value===h))==null?void 0:e.label)||"";m(a)},[h,m]),S?s.jsxs("div",{children:["Error loading bills: ",S.message]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4 flex flex-col md:flex-row gap-4 justify-between items-center",children:[s.jsx(me,{placeholder:"Search bills...",onChange:J,className:"max-w-md w-full md:w-auto"}),s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:h,onChange:a=>{var r;const e=Number(a.target.value),l=((r=v.find(N=>N.value===e))==null?void 0:r.label)||"";K(e),m(l)},children:v.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx("select",{className:"p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",value:u,onChange:a=>M(Number(a.target.value)),children:fe.map(a=>s.jsx("option",{value:a.value,children:a.label},a.value))}),s.jsx("button",{onClick:Z,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",title:"Reset filters",children:s.jsx(re,{size:18})}),s.jsx("button",{onClick:ee,disabled:x,className:`p-2 ${x?"text-gray-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,title:x?"Exporting...":"Export bills",children:s.jsx(oe,{size:18})}),s.jsxs("button",{onClick:()=>X(),className:"px-4 py-2 flex items-center gap-2 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[s.jsx(Ne,{size:16}),"Filter"]})]})]}),s.jsx(le,{ref:w,columns:U,data:H,totalAmount:q,loading:_,pagingData:{total:y.total,pageIndex:y.page,pageSize:y.limit},onPaginationChange:W,onSelectChange:G}),s.jsx(be,{isOpen:T,onClose:()=>D(!1),bill:Y,refetch:z}),s.jsx(ye,{isOpen:$,billType:t,onClose:F,onRequestClose:F,onApplyFilters:P})]})};export{Te as B};
