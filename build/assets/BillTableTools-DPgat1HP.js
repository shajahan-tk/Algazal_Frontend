import{r as p,j as t,m as L}from"./index-B-3YdMmO.js";import{C as I}from"./ConfirmDialog-xKOVDICi.js";import{t as M,N as _}from"./toast-xjy4rp4Y.js";import{d as H,c as U,f as q,h as Y,i as z,j as G,k as Q,l as J,m as K,n as W}from"./api-C4nUkZdB.js";import"./Alert-QJLDMk5I.js";import"./index-Bo39LFtR.js";import"./Badge-B2PjptLi.js";import{B as X}from"./Button-CfVbO-qU.js";import{D as k}from"./index-DCFjNNBJ.js";import"./Card-Dg6B2cp2.js";import"./Skeleton-C9LsrBBE.js";import"./Dialog-DSC5KQx1.js";import{D as Z}from"./Drawer-CIBw5hlm.js";import"./index-DVAakj00.js";import{a as m}from"./FormItem-B_dHMuui.js";import"./useUniqueId-bhrNi0MA.js";import"./Input-m_H_R88b.js";import"./index-B_Yvn3dy.js";import"./index-Z4dDP0Pn.js";import"./index-BdrlLZgj.js";import"./index-5z68-iaN.js";import"./ScrollBar-C_iOIJGq.js";import{S as D}from"./Select-DPSULLBa.js";import"./Upload-CuAXzTtV.js";import"./index-CqQ94ycg.js";import"./Tag-D_vNYl-M.js";import{F as ee,a as te,b as h}from"./formik.esm-DIqlYRh2.js";import{c as ae}from"./index.esm-uYrHGYFJ.js";import{c as se}from"./index-C3NLnlbc.js";import{f as P}from"./format-CBpsKyOP.js";import{_ as ne}from"./index-C7R1WpOH.js";const ke=({isOpen:v,onClose:l,bill:a,refetch:o,reportType:i})=>{const[y,j]=p.useState(!1);if(console.log(i,"123 reportType inn BillDeleteConfirmation"),!v||!a)return null;const x=()=>{var u,c;switch(a.billType||a.reportType||i){case"general":return`Delete General Bill ${a.invoiceNo?`#${a.invoiceNo}`:""}`;case"fuel":return"Delete Fuel Bill";case"mess":return"Delete Mess Bill";case"vehicle":return`Delete Vehicle Bill ${(u=a.vehicle)!=null&&u.vehicleNumber?`(Vehicle ${a.vehicle.vehicleNumber})`:""}`;case"accommodation":return`Delete Accommodation Bill ${(c=a.accommodation)!=null&&c.location?`(${a.accommodation.location})`:""}`;case"adib":return"Delete Adib Report";case"expense":return"Delete Expense Report";case"profit":return"Delete Profit Report";case"labour":return"Delete Labour Expenses Report";case"payroll":return"Delete Payroll Report";case"visaExpense":return"Delete Visa Expense Report";default:return"Delete Bill"}};console.log(a,"123 bill.billType inn BillDeleteConfirmation");const S=()=>{var u,c;switch(a.billType||a.reportType||i){case"general":return`Are you sure you want to delete this general bill${a.invoiceNo?` (Invoice #${a.invoiceNo})`:""}? This action cannot be undone.`;case"fuel":return"Are you sure you want to delete this fuel bill? This action cannot be undone.";case"mess":return"Are you sure you want to delete this mess bill? This action cannot be undone.";case"vehicle":return`Are you sure you want to delete this vehicle bill${(u=a.vehicle)!=null&&u.vehicleNumber?` for vehicle ${a.vehicle.vehicleNumber}`:""}? This action cannot be undone.`;case"accommodation":return`Are you sure you want to delete this accommodation bill${(c=a.accommodation)!=null&&c.location?` for ${a.accommodation.location}`:""}? This action cannot be undone.`;case"adib":return"Are you sure you want to delete this adib report? This action cannot be undone.";case"expense":return"Are you sure you want to delete this expense report? This action cannot be undone.";case"profit":return"Are you sure you want to delete this profit report? This action cannot be undone.";case"labour":return"Are you sure you want to delete this labour expenses report? This action cannot be undone.";case"payroll":return"Are you sure you want to delete this payroll report? This action cannot be undone.";case"visaExpense":return"Are you sure you want to delete this visa expense report? This action cannot be undone.";default:return"Are you sure you want to delete this bill? This action cannot be undone."}},w=async()=>{var u,c;j(!0);try{await a.billType?H(a._id):i==="profit"?U(a._id):i==="labour"?q(a._id):i==="payroll"?Y(a._id):i==="visaExpense"?z(a._id):G(a._id),o(),M.push(t.jsx(_,{title:`${x()} deleted successfully`,type:"success",duration:2500,children:a.billType?"The bill has been successfully deleted.":"The report has been successfully deleted."}),{placement:"top-center"}),l()}catch(d){console.error("Delete failed:",d),M.push(t.jsx(_,{title:`Failed to delete ${x()}`,type:"danger",duration:2500,children:((c=(u=d==null?void 0:d.response)==null?void 0:u.data)==null?void 0:c.message)||d.message||"Something went wrong"}),{placement:"top-center"})}finally{j(!1)}};return t.jsxs(I,{isOpen:v,type:"danger",title:x(),confirmButtonColor:"red-600",onClose:l,onRequestClose:l,onCancel:l,onConfirm:w,confirmButtonDisabled:y,children:[t.jsx("p",{children:S()}),y&&t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsx("div",{className:"w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})})]})},T=[{label:"ADCB",value:"adcb"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"ADVANCE",value:"advance"},{label:"MASHREQ CARD",value:"masherq_card"},{label:"ATHEER PLUS",value:"atheer_plus"}],Pe=({isOpen:v,onClose:l,onRequestClose:a,billType:o,onApplyFilters:i})=>{const[y,j]=p.useState([]),[x,S]=p.useState([]),[w,u]=p.useState([]),[c,d]=p.useState([]),[E,O]=p.useState(!0);p.useEffect(()=>{(async()=>{var f,g,N,s,n,e,V,F;try{const[b,B,C,R]=await Promise.all([Q(),J(),K(),W()]);j(((g=(f=b==null?void 0:b.data)==null?void 0:f.shops)==null?void 0:g.map(r=>({label:`${r.shopName} (${r.shopNo})`,value:r._id})))||[]),S(((s=(N=B==null?void 0:B.data)==null?void 0:N.categories)==null?void 0:s.map(r=>({label:r.name,value:r._id})))||[]),u(((e=(n=C==null?void 0:C.data)==null?void 0:n.vehicles)==null?void 0:e.map(r=>({label:r.vehicleNumber,value:r._id})))||[]),d(((F=(V=R==null?void 0:R.data)==null?void 0:V.users)==null?void 0:F.map(r=>({label:`${r.firstName} ${r.lastName}`,value:r._id})))||[])}catch(b){console.error("Error loading filter options",b)}finally{O(!1)}})()},[]);const $=new Date;return t.jsx(Z,{title:"Filter Reports and Bills",isOpen:v,onClose:l,onRequestClose:a,children:t.jsx(ee,{initialValues:{startDate:"",endDate:"",category:"",shop:"",vehicleNo:"",paymentMethod:"",employee:""},validationSchema:ae({}),onSubmit:A=>{i==null||i(A),setTimeout(()=>{l==null||l(new MouseEvent("click"))},100)},children:({values:A,errors:f,touched:g,resetForm:N})=>t.jsxs(te,{className:"space-y-4",children:[t.jsx(m,{label:"Start Date",invalid:!!f.startDate&&g.startDate,children:t.jsx(h,{name:"startDate",children:({field:s,form:n})=>t.jsx(k,{placeholder:"Select Start Date",value:s.value?new Date(s.value):null,maxDate:$,onChange:e=>n.setFieldValue(s.name,e?P(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),t.jsx(m,{label:"End Date",invalid:!!f.endDate&&g.endDate,children:t.jsx(h,{name:"endDate",children:({field:s,form:n})=>t.jsx(k,{placeholder:"Select End Date",value:s.value?new Date(s.value):null,maxDate:$,onChange:e=>n.setFieldValue(s.name,e?P(new Date(e.getFullYear(),e.getMonth(),e.getDate()),"yyyy-MM-dd"):"")})})}),(o==="general"||o==="mess"||o==="accommodation"||o==="vehicle"||o==="adib")&&t.jsx(m,{label:"Shop Name",children:t.jsx(h,{name:"shop",children:({field:s,form:n})=>t.jsx(D,{placeholder:"Select Shop",options:y,value:y.find(e=>e.value===s.value),onChange:e=>n.setFieldValue(s.name,(e==null?void 0:e.value)||""),loading:E})})}),(o==="general"||o==="adib")&&t.jsx(m,{label:"Category",children:t.jsx(h,{name:"category",children:({field:s,form:n})=>t.jsx(D,{placeholder:"Select Category",options:x,value:x.find(e=>e.value===s.value),onChange:e=>n.setFieldValue(s.name,(e==null?void 0:e.value)||""),loading:E})})}),(o==="vehicle"||o==="fuel")&&t.jsx(m,{label:"Vehicle No",children:t.jsx(h,{name:"vehicleNo",children:({field:s,form:n})=>t.jsx(D,{placeholder:"Select Vehicle",options:w,value:w.find(e=>e.value===s.value),onChange:e=>n.setFieldValue(s.name,(e==null?void 0:e.value)||""),loading:E})})}),["general","mess","fuel","vehicle","accommodation"].includes(o)&&t.jsx(m,{label:"Payment Method",children:t.jsx(h,{name:"paymentMethod",children:({field:s,form:n})=>t.jsx(D,{placeholder:"Select Payment Method",options:T,value:T.find(e=>e.value===s.value),onChange:e=>n.setFieldValue(s.name,(e==null?void 0:e.value)||"")})})}),(o==="visaExpense"||o==="labour"||o==="payroll")&&t.jsx(m,{label:"Employee",children:t.jsx(h,{name:"employee",children:({field:s,form:n})=>t.jsx(D,{placeholder:"Select Employee",options:c,value:c.find(e=>e.value===s.value),onChange:e=>n.setFieldValue(s.name,(e==null?void 0:e.value)||"")})})}),t.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>N(),className:"flex items-center gap-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-1.5 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:[t.jsx(se,{className:"text-base"}),"Reset"]}),t.jsx("button",{type:"submit",className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700",children:"Apply Filters"})]})]})})})},Te=({to:v,title:l})=>t.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:t.jsx(L,{className:"block lg:inline-block md:mb-0 mb-4",to:v,children:t.jsx(X,{block:!0,variant:"solid",size:"sm",icon:t.jsx(ne,{}),children:l})})});export{Te as B,ke as a,Pe as b};
