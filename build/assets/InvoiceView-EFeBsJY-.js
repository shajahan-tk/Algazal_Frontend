import{an as M,j as e,r as u,u as Q,ak as X,a4 as Z,b as _}from"./index-DrziBPhZ.js";import{C as J}from"./Views-D-uBkVS-.js";import{C as K}from"./Card-nlnRLrlQ.js";import{B as R}from"./Button-DG2-jqZG.js";import{L as ee}from"./Logo-C_0HS2pH.js";import"./Alert-BLGo7HyM.js";import"./index-yw21U4bP.js";import"./Badge-C2KmHilm.js";import"./index-BmalSfvl.js";import"./Skeleton-C2woZuKJ.js";import{D as re}from"./Dialog-D7FxUuyk.js";import"./Drawer-IABuvwPK.js";import"./index-8tDMqpHX.js";import"./FormItem-Cku4jOg1.js";import"./useUniqueId-B25XPIVz.js";import{I as se}from"./Input-B4wHBRkW.js";import"./index-DKNJHN__.js";import"./index-ChB5CpHQ.js";import{t as g,N as y}from"./toast-ClnWKBBo.js";import"./index-DN1w59Ps.js";import"./index-Cv7sYzj3.js";import"./ScrollBar-CAweRmRR.js";import"./Select-nm3Sb7o5.js";import"./Upload-DVKHQbcn.js";import{T as $}from"./index-BPwFYay9.js";import"./Tag-C5UAaR6R.js";import{u as te}from"./useThemeClass-DpghVrlu.js";import{u as oe,a as ne,c as ae,f as H}from"./index-GlPtBqgB.js";import{N as ie}from"./react-number-format.es-DAzjD6Ej.js";import"./context-B0dog8SG.js";import"./StatusIcon-vuYtWMPB.js";import"./index-Ds8t50Me.js";import"./CloseButton-CSyekQus.js";import"./proxy-MIyuRDz8.js";import"./floating-ui.react-K4q-Qtxj.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-3lctU3d7.js";import"./useControllableState-0JrmfMFZ.js";import"./_getPrototype-Dk_uG1mG.js";import"./index-CBr4D0uW.js";import"./toString-9EwY3KIP.js";import"./chainedFunction-BxZSneMW.js";import"./index-Csg7nRTo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-u5YpxD3p.js";import"./index-KN0VPQ3v.js";const le=async s=>{var o,n;try{const r=await M.get(`/project/${s}/invoice`);if(!r.data)throw new Error("No data received from server");return r.data.data}catch(r){throw console.error("API Error:",r),new Error(((n=(o=r.response)==null?void 0:o.data)==null?void 0:n.message)||"Failed to fetch invoice data")}},ce=async s=>{try{return console.log("Downloading invoice PDF for project:",s),(await M.get(`/project/${s}/invoice/pdf`,{responseType:"blob"})).data}catch(o){throw console.error("Error downloading invoice PDF:",o),o}},de=async(s,o)=>{try{return(await M.put(`/project/${s}/grn-number`,{grnNumber:o})).data}catch(n){throw console.error("Error adding GRN number:",n),n}},{Tr:S,Th:me,Td:v,THead:ue,TBody:pe,TFoot:he}=$,Y=({label:s,value:o})=>e.jsxs(S,{children:[e.jsx(v,{className:"!border-t-0",colSpan:3}),e.jsx(v,{className:"font-semibold !border-t-0 text-right",children:s}),e.jsx(v,{className:"!py-3 !border-t-0",children:e.jsx(F,{amount:o})})]}),F=({amount:s=0})=>e.jsx(ie,{displayType:"text",value:(Math.round(s*100)/100).toFixed(2),suffix:" AED",thousandSeparator:!0}),T=ae(),xe=[T.accessor("sno",{header:"Item",cell:s=>s.getValue()}),T.accessor("description",{header:"Description"}),T.accessor("qty",{header:"Qty"}),T.accessor("unitPrice",{header:"Unit Price (AED)",cell:s=>e.jsx(F,{amount:s.getValue()})}),T.accessor("total",{header:"Total (AED)",cell:s=>e.jsx(F,{amount:s.getValue()})})],fe=({products:s=[],summary:o={}})=>{const n=oe({data:s,columns:xe,getCoreRowModel:ne()});return e.jsxs($,{children:[e.jsx(ue,{children:n.getHeaderGroups().map(r=>e.jsx(S,{children:r.headers.map(l=>e.jsx(me,{colSpan:l.colSpan,children:H(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),e.jsx(pe,{children:n.getRowModel().rows.map(r=>e.jsx(S,{children:r.getVisibleCells().map(l=>e.jsx(v,{children:H(l.column.columnDef.cell,l.getContext())},l.id))},r.id))}),e.jsxs(he,{children:[e.jsx(Y,{label:"Amount (AED)",value:o.amount}),e.jsx(Y,{label:"VAT 5% (AED)",value:o.vat}),e.jsxs(S,{children:[e.jsx(v,{className:"!border-t-0",colSpan:3}),e.jsx(v,{className:"font-semibold text-base text-right",children:"Total Receivable (AED)"}),e.jsx(v,{className:"font-semibold text-base !py-3",children:e.jsx(F,{amount:o.totalReceivable})})]})]})]})},je=({isOpen:s,onClose:o,onSave:n,projectId:r,refetch:l,number:c})=>{const[d,w]=u.useState(c||""),[N,x]=u.useState(""),[f,m]=u.useState(!1);u.useEffect(()=>{w(c||""),x("")},[s,c]);const E=D=>{w(D.target.value),N&&x("")},A=async D=>{var C,P,t;if(D.preventDefault(),!d.trim()){x("GRN number is required");return}if(c&&d===c){g.push(e.jsx(y,{title:"Info",type:"info",duration:2500,children:"GRN number hasn't changed"}),{placement:"top-center"}),o();return}try{m(!0),x(""),await de(r,d),l(),n==null||n(d),g.push(e.jsxs(y,{title:"Success",type:"success",duration:2500,children:[c?"GRN number updated":"GRN number saved"," successfully"]}),{placement:"top-center"}),o()}catch(a){const j=((P=(C=a==null?void 0:a.response)==null?void 0:C.data)==null?void 0:P.message)||((t=a==null?void 0:a.data)==null?void 0:t.message)||a.message||"Failed to save GRN number";x(j),g.push(e.jsx(y,{title:"Error",type:"danger",duration:2500,children:j}),{placement:"top-center"})}finally{m(!1)}};return e.jsxs(re,{isOpen:s,onClose:o,onRequestClose:o,width:500,children:[e.jsx("h5",{className:"mb-4",children:c?"Update GRN Number":"Add GRN Number"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"grnNumber",className:"block mb-2",children:["GRN Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{id:"grnNumber",placeholder:"Enter GRN number",value:d,onChange:E,disabled:f}),N&&e.jsx("p",{className:"mt-1 text-red-500",children:N})]}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(R,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:o,disabled:f,children:"Cancel"}),e.jsx(R,{variant:"solid",onClick:A,loading:f,children:f?"Processing...":c?"Update":"Save"})]})]})},be=()=>{te();const s=Q(t=>t.theme.mode),[o,n]=u.useState(!0),[r,l]=u.useState(null),[c,d]=u.useState(null),[w,N]=u.useState(!1),[x,f]=u.useState(!1),{projectId:m}=X();console.log(r);const E=async()=>{try{if(n(!0),d(null),!m)throw new Error("Project ID is required");const t=await le(m);if(!t||!t.invoiceNumber||!t.vendor||!t.vendee||!Array.isArray(t.products))throw new Error("Invalid invoice data received from server");l(t)}catch(t){console.error("Error fetching invoice data:",t),d(t instanceof Error?t.message:"Failed to load invoice data")}finally{n(!1)}};u.useEffect(()=>{E()},[m]);const A=async()=>{var t;if(!m){g.push(e.jsx(y,{title:"Error",type:"danger",children:"Project ID is required"}));return}N(!0),d(null);try{const a=await ce(m),j=window.URL.createObjectURL(new Blob([a])),h=document.createElement("a");h.href=j,h.setAttribute("download",`invoice_${(r==null?void 0:r.invoiceNumber)||m}.pdf`),document.body.appendChild(h),h.click(),(t=h.parentNode)==null||t.removeChild(h),window.URL.revokeObjectURL(j),g.push(e.jsx(y,{title:"Success",type:"success",children:"PDF downloaded successfully"}))}catch(a){console.error("PDF download error:",a),d("Failed to download PDF"),g.push(e.jsx(y,{title:"Error",type:"danger",children:"Failed to download PDF"}))}finally{N(!1)}},D=()=>{f(!0)},C=()=>{f(!1)},P=t=>{if(t===0)return"Zero AED only";const a=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],j=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],h=["","Ten","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],G=["","Thousand","Million","Billion","Trillion"],k=i=>{if(i===0)return"";let p=[];const W=Math.floor(i/100);W>0&&p.push(a[W]+" Hundred");const b=i%100;if(b>0)if(b<10)p.push(a[b]);else if(b<20)p.push(j[b-10]);else{const z=Math.floor(b/10),q=b%10;p.push(h[z]),q>0&&p.push(a[q])}return p.join(" ")},L=Math.floor(t).toString(),I=[];for(let i=L.length;i>0;i-=3)I.push(parseInt(L.substring(Math.max(0,i-3),i),10));let B=[];for(let i=0;i<I.length;i++){const p=k(I[i]);p&&B.unshift(p+(G[i]?" "+G[i]:""))}const V=Math.round((t-Math.floor(t))*100);let U="";V>0&&(U=" and "+k(V)+" Fils");const O=B.join(" ")+U+" AED only";return O.charAt(0).toUpperCase()+O.slice(1).toLowerCase()};return c?e.jsxs("div",{className:"p-4 text-center text-red-500",children:[c,e.jsx(R,{className:"mt-4",onClick:E,children:"Retry"})]}):o||!r?e.jsx(Z,{loading:!0}):e.jsxs("div",{className:"print:p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"mb-3",mode:s}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"TAX INVOICE"})]}),e.jsx("div",{className:"my-4",children:e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["PO Box No: ",r.vendor.poBox]}),e.jsxs("span",{children:["Date: ",_(r.date).format("DD/MM/YYYY")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Dubai, UAE"}),e.jsxs("span",{children:["INV #: ",r.invoiceNumber]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Website: www.alghazalgroup.com"}),e.jsxs("span",{children:["Order No: ",r.orderNumber]})]})]})})]}),e.jsx("div",{className:"border-t border-b border-gray-200 dark:border-gray-600 py-4 my-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Vendee"}),e.jsxs("p",{className:"whitespace-pre-line",children:[r.vendee.name,e.jsx("br",{}),r.vendee.address,e.jsx("br",{}),"Phone: ",r.vendee.phone]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-2",children:"Vendor"}),e.jsxs("p",{className:"whitespace-pre-line",children:[r.vendor.name,e.jsx("br",{}),"PB: ",r.vendor.poBox," ",r.vendor.address,e.jsx("br",{}),"Phone: ",r.vendor.phone,e.jsx("br",{}),"TRN#: ",r.vendor.trn,e.jsx("br",{}),"GRN Number: ",r.vendee.grnNumber,e.jsx("br",{}),"LPO No.: ",r.vendee.supplierNumber,e.jsx("br",{}),"Service Period: ",r.vendee.servicePeriod]})]})]})}),e.jsx("div",{className:"my-6",children:e.jsx(fe,{products:r.products,summary:r.summary})}),e.jsxs("div",{className:"my-6",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Comments or special instructions"}),e.jsxs("p",{children:["Payment: ",r.paymentTerms]}),e.jsxs("p",{children:["Amt in Words: ",P(r.summary.totalReceivable)]})]}),e.jsx("div",{className:"mt-8"}),e.jsxs("div",{className:"print:hidden mt-6 flex items-center justify-end gap-2",children:[e.jsx(R,{variant:"solid",onClick:D,className:"mr-2",children:"Add GRN number"}),e.jsx(R,{variant:"solid",loading:w,onClick:A,children:w?"Generating PDF...":"Download Invoice"})]}),e.jsx(je,{isOpen:x,onClose:C,projectId:m,number:r.vendee.grnNumber,refetch:E})]})},ur=()=>e.jsx(J,{className:"h-full",children:e.jsx(K,{className:"h-full",bodyClass:"h-full",children:e.jsx(be,{})})});export{ur as default};
