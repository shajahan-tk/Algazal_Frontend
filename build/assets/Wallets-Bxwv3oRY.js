import{j as e,c as Le,ao as ue,aa as pe,ab as Me,ad as De,r as c,m as Fe,an as T,a4 as xe,ak as he,v as ge,u as qe,am as Ue,b as We,ae as ze}from"./index-CDUqAS1l.js";import"./Alert-DL8X4Uab.js";import{A as R}from"./index-C1Nx0TEh.js";import{B as $}from"./Badge-hMcflglf.js";import{B as b}from"./Button-BPBskG9o.js";import"./index-CRkWz9hY.js";import{C as A}from"./Card-Bb8Omztx.js";import"./Skeleton-DoyxclK2.js";import{D as fe}from"./Dialog-C7AMlNhG.js";import{D as Be}from"./Drawer-peSRAyXS.js";import"./index-DvFxqpjx.js";import"./FormItem-ByEmqHQ5.js";import"./useUniqueId-CQBDBfVD.js";import{I as Ve}from"./Input-DXBk0KXn.js";import"./index-Dk4smkVo.js";import"./index-cjDbE1Ce.js";import{t as k,N as C}from"./toast-DGerJIJB.js";import"./index-DQYmJabE.js";import"./index-ChKfPKLA.js";import"./ScrollBar-QR2Zwrhq.js";import"./Select-Bc7Wf5rB.js";import"./Upload-BJb1fzL_.js";import"./index-CocX0oO3.js";import{T as Ye}from"./Tag-Bq5dzNE2.js";import{af as Ge,a4 as Qe,a5 as Xe,ag as Je,a6 as Ke,ah as ae,ai as Ze,aj as es,O as je,H as ss,x as ts,ak as rs,al as ns,am as is,a0 as as,n as oe,V as os,an as cs,T as ls,j as ds,ao as ms}from"./index-BerpkDBA.js";import{N as us}from"./react-number-format.es-WfborTZo.js";import{u as ps}from"./useThemeClass-5GKJG2gx.js";import{i as xs}from"./index-CBdLSIrO.js";import{A as hs}from"./AdaptableCard-BXZ7gMWR.js";import{C as gs}from"./Views-DmS3tele.js";import"./chart.config-CZuakYno.js";import"./DataTable-CVcq30BR.js";import"./SvgIcon-DCpuHJM3.js";import"./SegmentItemOption-CD7-Nqsw.js";import"./StatusIcon-twe9Eqr7.js";import"./CloseButton-BXRa_ZJ2.js";import"./proxy-Dk6QltiT.js";import"./floating-ui.react-CCBWD0pR.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-CJy_8sJq.js";import"./context-D-kJGxG9.js";import"./useControllableState-DyX12gyY.js";import"./_getPrototype-CIMlDKAv.js";import"./index-CjDcj2AV.js";import"./toString-DOI2nrr_.js";import"./chainedFunction-BxZSneMW.js";import"./index-DlSvysZf.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-BmYztAKh.js";import"./index-B2bfEVVx.js";import"./cloneDeep-DJN0yfLA.js";const _=({className:s,asElement:t="span",icon:a,children:i})=>e.jsxs(t,{className:Le("flex items-center gap-2",s),children:[a,i]});async function fs(){return ue.fetchData({url:"/crypto/wallets",method:"get"})}async function js(s){return ue.fetchData({url:"/crypto/wallets/history",method:"post",data:s})}const D="cryptoWallets",ce=pe(D+"/getWalletData",async()=>(await fs()).data),le=pe(D+"/getTransctionHistoryData",async s=>(await js(s)).data),ys={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},bs={loading:!0,walletsData:[],transactionHistoryLoading:!0,transactionHistoryData:[],tableData:ys,selectedTab:"trade"},ye=Me({name:`${D}/state`,initialState:bs,reducers:{setSelectedTab:(s,t)=>{s.selectedTab=t.payload},setTableData:(s,t)=>{s.tableData=t.payload},setTransactionHistoryData:(s,t)=>{s.transactionHistoryData=t.payload}},extraReducers:s=>{s.addCase(ce.fulfilled,(t,a)=>{t.loading=!1,t.walletsData=a.payload}).addCase(ce.pending,t=>{t.loading=!0}).addCase(le.fulfilled,(t,a)=>{t.transactionHistoryLoading=!1,t.tableData.total=a.payload.total,t.transactionHistoryData=a.payload.data}).addCase(le.pending,t=>{t.transactionHistoryLoading=!0})}}),{setSelectedTab:Wt,setTableData:zt,setTransactionHistoryData:Bt}=ye.actions,vs=ye.reducer,Ns=De({data:vs});var ws={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function ks(s){if(typeof s=="number")return{value:s,unit:"px"};var t,a=(s.match(/^[0-9.]*/)||"").toString();a.includes(".")?t=parseFloat(a):t=parseInt(a,10);var i=(s.match(/[^0-9]*$/)||"").toString();return ws[i]?{value:t,unit:i}:(console.warn("React Spinners: ".concat(s," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}function de(s){var t=ks(s);return"".concat(t.value).concat(t.unit)}var Cs=function(s,t,a){var i="react-spinners-".concat(s,"-").concat(a);if(typeof window>"u"||!window.document)return i;var o=document.createElement("style");document.head.appendChild(o);var d=o.sheet,r=`
    @keyframes `.concat(i,` {
      `).concat(t,`
    }
  `);return d&&d.insertRule(r,0),i},L=function(){return L=Object.assign||function(s){for(var t,a=1,i=arguments.length;a<i;a++){t=arguments[a];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(s[o]=t[o])}return s},L.apply(this,arguments)},Ss=function(s,t){var a={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(a[i[o]]=s[i[o]]);return a},As=Cs("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function me(s){var t=s.loading,a=t===void 0?!0:t,i=s.color,o=i===void 0?"#000000":i,d=s.speedMultiplier,r=d===void 0?1:d,p=s.cssOverride,h=p===void 0?{}:p,x=s.size,g=x===void 0?35:x,u=Ss(s,["loading","color","speedMultiplier","cssOverride","size"]),v=L({background:"transparent !important",width:de(g),height:de(g),borderRadius:"100%",border:"2px solid",borderTopColor:o,borderBottomColor:"transparent",borderLeftColor:o,borderRightColor:o,display:"inline-block",animation:"".concat(As," ").concat(.75/r,"s 0s infinite linear"),animationFillMode:"both"},h);return a?c.createElement("span",L({style:v},u)):null}const Ts=({clientinformation:s})=>{var t,a,i,o,d;return e.jsxs(A,{children:[e.jsx("h5",{className:"mb-4",children:"Customer"}),e.jsxs(Fe,{className:"group flex items-center justify-between",to:"/app/crm/customer-details?id=11",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"ltr:ml-2 rtl:mr-2",children:e.jsxs("span",{children:["Name : ",(t=s==null?void 0:s.client)==null?void 0:t.clientName]})})}),e.jsx(Ge,{className:"text-xl hidden group-hover:block"})]}),e.jsx("hr",{className:"my-5"}),e.jsx(_,{className:"mb-4",icon:e.jsx(Qe,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(a=s==null?void 0:s.client)==null?void 0:a.email})}),e.jsx(_,{icon:e.jsx(xs,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})}),e.jsx("br",{}),e.jsx(_,{icon:e.jsx(Xe,{className:"text-xl opacity-70"}),children:e.jsx("span",{className:"font-semibold",children:(o=s==null?void 0:s.client)==null?void 0:o.telephoneNumber})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-4",children:"Shipping Address"}),e.jsx("address",{className:"not-italic",children:e.jsx("div",{className:"mb-1",children:(d=s==null?void 0:s.client)==null?void 0:d.clientAddress})})]})},Is=({projectdetails:s})=>{var t,a,i;return e.jsxs(A,{children:[e.jsx("h5",{className:"mb-4",children:"Project Details"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ltr:ml-2 rtl:mr-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectName}),e.jsx("div",{className:"font-semibold text-lg",children:s==null?void 0:s.projectNumber})]})}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Project Description"}),e.jsxs("div",{className:"flex items-start mb-5",children:[e.jsx(Je,{className:"text-xl opacity-70 mt-1 mr-2"}),e.jsx("p",{className:"text-gray-700",children:(s==null?void 0:s.projectDescription)||"No description provided"})]}),e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Site Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(_,{icon:e.jsx(Ke,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Site Location"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.location)||"Not specified"})]})}),e.jsx(_,{icon:e.jsx(ae,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Building"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.building)||"Not specified"})]})}),e.jsx(_,{icon:e.jsx(ae,{className:"text-xl opacity-70"}),children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Apartment"}),e.jsx("div",{className:"text-gray-700",children:(s==null?void 0:s.apartmentNumber)||"Not specified"})]})})]}),(s==null?void 0:s.client)&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-5"}),e.jsx("h6",{className:"mb-3",children:"Client Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Name: "}),e.jsx("span",{children:(t=s==null?void 0:s.client)==null?void 0:t.clientName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Address: "}),e.jsx("span",{children:(a=s==null?void 0:s.client)==null?void 0:a.clientAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Phone: "}),e.jsx("span",{children:(i=s==null?void 0:s.client)==null?void 0:i.mobileNumber})]})]})]})]})},H=async s=>{try{console.log("project data : ",s);const t=await T.get(`/project/${s}`);return console.log(t),t.data}catch(t){throw console.log(t),t}},_s=async()=>{try{const s=await T.get("/user/engineers/");return console.log(s),s.data}catch(s){throw console.log(s),s}},Es=async({projectId:s,engineerId:t})=>{var a;try{return console.log(s,"project id"),console.log(t,"engineerId "),(await T.post(`/project/${s}/assign`,{assignedTo:t})).data}catch(i){throw console.error("Assignment error details:",{error:i,response:(a=i.response)==null?void 0:a.data}),i}},Ps=async({estimationId:s,isChecked:t,comment:a})=>{var i;try{return(await T.patch(`/estimation/${s}/check`,{isChecked:t,comment:a})).data}catch(o){throw console.error("Error checking project:",{error:o,response:(i=o.response)==null?void 0:i.data}),o}},Os=async({estimationId:s,isApproved:t,comment:a})=>{var i;try{return(await T.patch(`/estimation/${s}/approve`,{isApproved:t,comment:a})).data}catch(o){throw console.error("Error checking project:",{error:o,response:(i=o.response)==null?void 0:i.data}),o}},Hs=async s=>{try{return await T.get(`/comment/${s}`)}catch(t){throw console.log(t),t}},$s=async(s,t)=>{try{console.log("idddd",s);const a=await T.post(`/comment/${s}`,{content:t});return console.log(a),a.data}catch(a){throw console.log(a),a}},be=({children:s,...t})=>e.jsx(R,{...t,size:30,shape:"circle",children:s}),Rs=({status:s,time:t})=>{const i=(()=>{switch(s.toLowerCase()){case"approval":case"approved":return{bg:"bg-emerald-500",icon:e.jsx(ss,{className:"text-white"}),text:"Approved"};case"check":case"checked":return{bg:"bg-yellow-500",icon:e.jsx(je,{className:"text-white"}),text:"Checked"};case"reject":case"rejected":return{bg:"bg-red-500",icon:e.jsx(es,{className:"text-white"}),text:"Rejected"};default:return{bg:"bg-blue-500",icon:e.jsx(Ze,{className:"text-white"}),text:"General"}}})();return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{prefix:!0,className:`${i.bg} text-white mr-2 rtl:ml-2`,prefixClass:i.bg,children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:i.icon}),i.text]})}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t})]})},Ls=({comment:s})=>e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx(be,{src:s.img})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100 mr-2",children:s.name}),e.jsx(Rs,{status:s.actionType||"general",time:s.time})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200 pl-1",children:s.comment})]})]}),Ms=({projectId:s,refresh:t=!1})=>{const[a,i]=c.useState(!0),[o,d]=c.useState([]),[r,p]=c.useState(!1),h=c.useRef(null),[x,g]=c.useState("");c.useEffect(()=>{s&&u()},[s,t]);const u=async()=>{i(!0);try{const w=((await Hs(s)).data.data||[]).map(f=>{const N=f.user||{},E=`${N.firstName||""} ${N.lastName||""}`.trim()||"Unknown User";return g(N.profileImage),{id:f._id,name:E,img:N.profileImage?N.profileImage:"/img/avatars/thumb-1.jpg",time:f.createdAt?new Date(f.createdAt).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0,day:"numeric",month:"short"}):"Just now",comment:f.content||"",actionType:f.actionType||"general"}});d(w)}catch(m){console.error("Failed to fetch comments:",m)}finally{i(!1)}},v=async()=>{var j;const m=(j=h.current)==null?void 0:j.value;if(!(!(m!=null&&m.trim())||!s))try{p(!0);const w={id:Date.now().toString(),name:"You",img:"/img/avatars/thumb-1.jpg",time:"just now",comment:m,actionType:"general"};d(f=>[w,...f]),h.current&&(h.current.value=""),await $s(s,m),await u()}catch(w){console.error("Failed to post comment:",w),d(f=>f.filter(N=>N.id!==Date.now().toString()))}finally{p(!1)}};return e.jsx(gs,{className:"h-full",children:e.jsx(xe,{loading:a,children:e.jsxs(hs,{bodyClass:"p-5",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Activity"}),e.jsx("div",{className:"mb-6",children:o.map(m=>e.jsx(Ls,{comment:m},m.id))}),e.jsxs("div",{className:"mt-6 mb-3 flex flex-auto",children:[e.jsx(be,{src:x}),e.jsx("div",{className:"ml-4 rtl:mr-4 w-full",children:e.jsx(Ve,{ref:h,textArea:!0,placeholder:"Leave a comment",disabled:r})})]}),e.jsx("div",{className:"text-right",children:e.jsx(b,{variant:"solid",onClick:v,loading:r,disabled:r,children:"Comment"})})]})})})},Ds=({data:s,onAddClick:t})=>{ps();const a=ge(),{id:i}=he(),o=()=>{switch(s.type){case"estimation":return e.jsx(oe,{className:"text-2xl"});case"quotation":return e.jsx(ms,{className:"text-2xl"});case"lpo":return e.jsx(ds,{className:"text-2xl"});case"workProgress":return e.jsx(ls,{className:"text-2xl"});case"invoice":return e.jsx(cs,{className:"text-2xl"});case"expenseTracker":return e.jsx(os,{className:"text-2xl"});default:return e.jsx(oe,{className:"text-2xl"})}},d=()=>{s.exists?s.type==="quotation"?a(`/app/quotation-view/${i}`):s.type==="expenseTracker"?a(s.viewRoute||`/app/expense/${i}`):a(s.viewRoute||s.route,{state:{projectId:i}}):t(s.type)},r=()=>{switch(s.type){case"estimation":return"blue-600";case"quotation":return"purple-600";case"lpo":return"green-600";case"workProgress":return"orange-600";case"invoice":return"indigo-600";case"expenseTracker":return"red-600";default:return"gray-600"}};return e.jsx(A,{className:"h-full transition-all duration-200 hover:shadow-lg",children:s.exists?e.jsxs("div",{className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{size:40,icon:o()}),e.jsx("h6",{className:"font-bold text-gray-800 dark:text-gray-100",children:s.title})]}),s.status&&e.jsx($,{content:s.status,innerClass:`${s.status==="approved"?"bg-emerald-500":s.status==="pending"?"bg-amber-500":"bg-blue-500"}`})]}),e.jsxs("div",{className:"mt-auto",children:[s.amount&&e.jsx("h5",{className:"mb-2 text-lg font-semibold text-gray-900 dark:text-white",children:e.jsx(us,{displayType:"text",value:s.amount,prefix:"$",thousandSeparator:!0,decimalScale:2})}),s.date&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:We(s.date).format("MMM D, YYYY")}),e.jsxs(b,{className:"w-full",size:"sm",variant:"twoTone",icon:e.jsx(je,{className:"text-lg"}),onClick:d,color:r(),children:["View ",s.title]})]})]}):e.jsx(A,{clickable:!0,className:"border-dashed border-2 hover:border-indigo-600 hover:dark:border-gray-300 bg-transparent h-full flex items-center justify-center transition-colors duration-200",onClick:d,children:e.jsxs("div",{className:"flex flex-col justify-center items-center py-5",children:[e.jsx("div",{className:"p-3 rounded-full bg-gray-100 dark:bg-gray-600 transition-colors duration-200",children:e.jsx(as,{className:"text-2xl text-gray-400 dark:text-gray-300"})}),e.jsxs("p",{className:"mt-3 font-semibold text-gray-600 dark:text-gray-300",children:["Add ",s.title]})]})})})},Fs=({isOpen:s,onClose:t,estimationId:a,onSuccess:i})=>{const[o,d]=c.useState(""),[r,p]=c.useState(!1),[h,x]=c.useState(null),g=async u=>{var v,m;p(!0),x(null);try{await Os({estimationId:a,isApproved:u,comment:o||void 0}),k.push(e.jsx(C,{title:`Project ${u?"approved":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t()}catch(j){console.error("Error updating project status:",j),x(((m=(v=j.response)==null?void 0:v.data)==null?void 0:m.message)||"Failed to update project status"),k.push(e.jsx(C,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{p(!1)}};return e.jsxs(fe,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Update Project Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:o,onChange:u=>d(u.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>g(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>g(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Approve"})]})]})},qs=Ue.memo(({isOpen:s,onClose:t,estimationId:a,onSuccess:i})=>{const[o,d]=c.useState(""),[r,p]=c.useState(!1),[h,x]=c.useState(null),g=async u=>{var v,m;p(!0),x(null);try{await Ps({estimationId:a,isChecked:u,comment:o||void 0}),k.push(e.jsx(C,{title:`Project ${u?"checked":"rejected"} successfully`,type:"success"}),{placement:"top-center"}),i(),t(),d("")}catch(j){console.error("Error updating project status:",j),x(((m=(v=j.response)==null?void 0:v.data)==null?void 0:m.message)||"Failed to update project status"),k.push(e.jsx(C,{title:"Failed to update project status",type:"danger"}),{placement:"top-center"})}finally{p(!1)}};return c.useEffect(()=>{s||(d(""),x(null))},[s]),e.jsxs(fe,{isOpen:s,onClose:t,width:500,className:"dark:bg-gray-800",children:[e.jsx("h5",{className:"mb-4 dark:text-white",children:"Check Status"}),h&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-600 rounded dark:bg-red-900/30 dark:text-red-400",children:h}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 dark:text-gray-300",children:"Comments"}),e.jsx("textarea",{className:"w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:4,value:o,onChange:u=>d(u.target.value),placeholder:"Enter your comments here..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(b,{variant:"plain",onClick:()=>g(!1),disabled:r,className:"text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/30",children:r?"Processing...":"Reject"}),e.jsx(b,{variant:"solid",onClick:()=>g(!0),disabled:r,className:"bg-blue-600 hover:bg-blue-700 text-white dark:bg-blue-500 dark:hover:bg-blue-600",children:r?"Processing...":"Checked"})]})]})}),Us=()=>{const{id:s}=he(),t=ge(),[a,i]=c.useState(!1),[o,d]=c.useState([]),[r,p]=c.useState(null),[h,x]=c.useState(!1),[g,u]=c.useState(!1),[v,m]=c.useState(""),[j,w]=c.useState(!1),[f,N]=c.useState(!1),[E,ve]=c.useState([]),[I,F]=c.useState(null),[Ne,q]=c.useState(!1),[U,W]=c.useState(!1),P=(qe(n=>n.auth.user.authority)||[])[0]||"finance",[we,z]=c.useState(!1),ke=async()=>{q(!0);try{const n=await _s();ve(n.data.engineers),r!=null&&r.assignedTo&&F(r.assignedTo._id)}catch(n){console.error("Failed to fetch engineers:",n),k.push(e.jsx(C,{title:"Failed to load engineers",type:"danger"}),{placement:"top-center"})}finally{q(!1)}},Ce=()=>{u(!0),ke()},B=()=>{u(!1)},Se=()=>{r!=null&&r.estimationId&&N(!0)},Ae=()=>{N(!1)},Te=n=>{m(n),w(!0)},Ie=()=>{w(!1)},_e=()=>{H(s).then(n=>{p(n==null?void 0:n.data),W(l=>!l)}),window.location.reload()},Ee=()=>{H(s).then(n=>{p(n==null?void 0:n.data),W(l=>!l)})},Pe=async()=>{var n,l;if(!I||!s){k.push(e.jsx(C,{title:"Please select an engineer",type:"warning"}),{placement:"top-center"});return}z(!0);try{await Es({projectId:s,engineerId:I}),k.push(e.jsx(C,{title:"Engineer assigned successfully",type:"success"}),{placement:"top-center"});const y=await H(s);p(y==null?void 0:y.data),B()}catch(y){console.error("Assignment failed:",y);let O="Failed to assign engineer";(l=(n=y.response)==null?void 0:n.data)!=null&&l.message&&(O=y.response.data.message),k.push(e.jsx(C,{title:O,type:"danger"}),{placement:"top-center"})}finally{z(!1)}},Oe=n=>{const l=o.find(y=>y.type===n);l&&(n==="expenseTracker"?t(l.exists?l.viewRoute||`/app/expense/${s}`:l.route):t(l.exists&&l.viewRoute||l.route,{state:{projectId:s}}))};return c.useEffect(()=>{x(!0),H(s).then(n=>{var Q,X,J,K,Z,ee,se,te,re,ne;p(n==null?void 0:n.data),x(!1);const l=((Q=n==null?void 0:n.data)==null?void 0:Q.status)||"draft",y=(X=n==null?void 0:n.data)==null?void 0:X.isApproved,O=!!((J=n==null?void 0:n.data)!=null&&J.assignedTo),V=!!((K=n==null?void 0:n.data)!=null&&K.estimationId),Y=!!((Z=n==null?void 0:n.data)!=null&&Z.quotationId),G=!!((ee=n==null?void 0:n.data)!=null&&ee.lpoId);(se=n==null?void 0:n.data)!=null&&se.lopId;const M=!!((te=n==null?void 0:n.data)!=null&&te.lpoId),He=!!((re=n==null?void 0:n.data)!=null&&re.expenseId);let S=[...[{type:"estimation",title:"Estimation",route:`/app/create-estimation/${s}`,viewRoute:V?`/app/estimation-view/${n.data.estimationId}`:void 0,exists:V,roles:["finance","super_admin","admin","engineer"]}]];y&&O&&S.push({type:"quotation",title:"Quotation",route:`/app/quotation-new/${s}`,viewRoute:Y?`/app/quotation-view/${s}`:void 0,exists:Y,roles:["finance","super_admin","admin"]}),["quotation_sent","lpo_received","work_started","in_progress","work_completed","invoice_sent"].includes(l)&&S.push({type:"lpo",title:"LPO",route:`/app/lpo/${s}`,exists:G,viewRoute:G?`/app/lpo-view/${s}`:void 0,roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(l)&&S.push({type:"workProgress",title:"Work Progress",route:M?void 0:"/app/workprogress",viewRoute:M?`/app/workprogress/${s}`:void 0,exists:M,roles:["finance","super_admin","admin","engineer"]}),l==="work_completed"&&S.push({type:"workCompletion",title:"Completion Report",viewRoute:`/app/workcompletionreport/${s}`,exists:!0,roles:["finance","super_admin","admin","engineer"]}),l==="work_completed"&&S.push({type:"invoice",title:"Invoice",viewRoute:s?`/app/invoice-view/${s}`:void 0,exists:s,roles:["finance","super_admin","admin"]}),["lpo_received","work_started","in_progress","work_completed","invoice_sent","team_assigned"].includes(l)&&S.push({type:"expenseTracker",title:"Expense Tracker",route:`/app/expense/${s}`,viewRoute:`/app/expense-view/${(ne=n==null?void 0:n.data)==null?void 0:ne.expenseId}`,exists:He,roles:["finance","super_admin","admin"]});const $e=S.filter(Re=>{var ie;return(ie=Re.roles)==null?void 0:ie.includes(P)});d($e),i(!1)}).catch(n=>{console.error("Error fetching project:",n),x(!1)})},[s,P,U]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:!a&&o.length>0?o.map(n=>e.jsx(Ds,{data:n,onAddClick:Oe},n.type)):[...Array(4).keys()].map(n=>e.jsx(A,{children:e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(me,{size:20,color:"#3b82f6",loading:a})})},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(Is,{projectdetails:r}),e.jsx(A,{children:e.jsx(Ms,{projectId:s,refresh:U})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ts,{clientinformation:r}),(r==null?void 0:r.estimationId)&&e.jsx(A,{children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between border-b pb-3 border-gray-200 dark:border-gray-600",children:e.jsx("h5",{className:"font-semibold",children:"Project Status"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Status:"}),e.jsx($,{content:(r==null?void 0:r.status)||"draft"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Engineer:"}),r!=null&&r.assignedTo?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:32,src:r.assignedTo.profileImage,shape:"circle"}),e.jsxs("span",{className:"font-medium",children:[r.assignedTo.firstName," ",r.assignedTo.lastName]})]}):e.jsx(b,{size:"xs",variant:"solid",icon:e.jsx(ts,{}),onClick:Ce,children:"Assign"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Checked:"}),e.jsx($,{content:r!=null&&r.isChecked?"Verified":"Pending",innerClass:r!=null&&r.isChecked?"bg-emerald-500":"bg-amber-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Approved:"}),e.jsx($,{content:r!=null&&r.isApproved?"Approved":"Pending",innerClass:r!=null&&r.isApproved?"bg-emerald-500":"bg-amber-500"})]})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[(r==null?void 0:r.assignedTo)&&e.jsx(b,{block:!0,variant:"solid",icon:e.jsx(rs,{}),onClick:()=>t(`/app/attendance-summary/${s}`),children:"View Attendance"}),["super_admin","admin"].includes(P)&&!(r!=null&&r.isApproved)&&e.jsx(b,{block:!0,variant:"solid",onClick:Se,disabled:!(r!=null&&r.isChecked),icon:r!=null&&r.isChecked?e.jsx(ns,{}):e.jsx(is,{}),children:r!=null&&r.isChecked?"Approve Project":"Needs Verification First"}),["super_admin","admin","engineer"].includes(P)&&!(r!=null&&r.isChecked)&&e.jsx(b,{block:!0,variant:"solid",onClick:()=>Te(s||""),children:"Verify Project"})]})]})})]})]}),e.jsx(Be,{title:"Assign Engineer",isOpen:g,onClose:B,width:400,children:Ne?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(xe,{})}):E.length>0?e.jsxs("div",{className:"space-y-4",children:[E.map(n=>{var l;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${I===n._id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700":"hover:bg-gray-50 dark:hover:bg-gray-700/50 border border-transparent"}`,onClick:()=>F(n._id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{size:40,src:n.profileImage,className:"mr-3",shape:"circle"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-gray-900 dark:text-white",children:[n.firstName," ",n.lastName]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:((l=n.phoneNumbers)==null?void 0:l[0])||"No phone number"})]})]}),I===n._id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})]},n._id)}),e.jsx("div",{className:"mt-6 flex justify-end",children:we?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(me,{size:20,color:"#3b82f6"})}):e.jsx(b,{variant:"solid",onClick:Pe,disabled:!I,children:I?"Confirm Assignment":"Select an engineer"})})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"No engineers available"})}),e.jsx(Fs,{isOpen:f,onClose:Ae,estimationId:r==null?void 0:r.estimationId,onSuccess:_e}),e.jsx(qs,{isOpen:j,onClose:Ie,estimationId:(r==null?void 0:r.estimationId)||"",onSuccess:Ee})]})};ze("cryptoWallets",Ns);const Vt=()=>e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(Us,{})});export{Vt as default};
