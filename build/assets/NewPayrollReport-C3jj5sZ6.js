import{r as b,j as e,v as O,ak as L}from"./index-DrziBPhZ.js";import{N as C,t as k}from"./toast-ClnWKBBo.js";import{n as D,K as I,L as U,M as $}from"./api-BL3Ea9lB.js";import{F as B,a as n}from"./FormItem-Cku4jOg1.js";import{B as S}from"./Button-DG2-jqZG.js";import{S as z}from"./StickyFooter-RWxGWKXo.js";import{F as J,a as K,b as u}from"./formik.esm-CPLrydYm.js";import{A as T}from"./index-CBDs7g4_.js";import{$ as _}from"./index-Ds8t50Me.js";import{c as H,b as c}from"./index.esm-BB-UMuCJ.js";import"./Alert-BLGo7HyM.js";import"./index-yw21U4bP.js";import"./Badge-C2KmHilm.js";import"./index-BmalSfvl.js";import"./Card-nlnRLrlQ.js";import"./Skeleton-C2woZuKJ.js";import"./Dialog-D7FxUuyk.js";import"./Drawer-IABuvwPK.js";import"./index-8tDMqpHX.js";import"./useUniqueId-B25XPIVz.js";import{I as h}from"./Input-B4wHBRkW.js";import"./index-DKNJHN__.js";import"./index-ChB5CpHQ.js";import"./index-DN1w59Ps.js";import"./index-Cv7sYzj3.js";import"./ScrollBar-CAweRmRR.js";import{S as V}from"./Select-nm3Sb7o5.js";import"./Upload-DVKHQbcn.js";import"./index-BPwFYay9.js";import"./Tag-C5UAaR6R.js";import{A as E}from"./AdaptableCard-DmZKEZU8.js";import"./Views-D-uBkVS-.js";import"./chart.config-DDCNvm2Q.js";import"./DataTable-aN3aFI0i.js";import"./SvgIcon-BvWLwctQ.js";import"./SegmentItemOption-Cj0dKbLO.js";import"./StatusIcon-vuYtWMPB.js";import"./CloseButton-CSyekQus.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-MIyuRDz8.js";import"./context-B0dog8SG.js";import"./index-3lctU3d7.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-u5YpxD3p.js";import"./floating-ui.react-K4q-Qtxj.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-0JrmfMFZ.js";import"./_getPrototype-Dk_uG1mG.js";import"./index-CBr4D0uW.js";import"./toString-9EwY3KIP.js";import"./index-Csg7nRTo.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-KN0VPQ3v.js";import"./index-GlPtBqgB.js";import"./useThemeClass-DpghVrlu.js";const q=b.forwardRef((f,d)=>{const{type:g,initialData:l={employee:"",labourCard:"",labourCardPersonalNo:"",period:"",allowance:"",deduction:"",mess:"",advance:"",net:"",remark:""},onFormSubmit:N,onDiscard:x,onDelete:j}=f,[v,w]=b.useState([]);b.useEffect(()=>{(async()=>{var o;try{const m=(o=(await D()).data)==null?void 0:o.users.map(i=>({value:i._id,label:`${i.firstName} ${i.lastName}`}));w(m)}catch(r){console.error("Failed to fetch users",r)}})()},[]);const P=H().shape({employee:c().required("Employee name is required"),labourCard:c().required("Labour Card is required"),labourCardPersonalNo:c().required("Labour Card Personal No is required"),period:c().required("Period is required"),allowance:c().required("Allowance is required"),deduction:c().required("Deduction is required"),mess:c().required("Mess is required"),advance:c().required("Advance is required"),net:c().required("Net is required"),remark:c().max(500,"Remark must be at most 500 characters")});return e.jsx(J,{innerRef:d,initialValues:{employee:l.employee||"",labourCard:l.labourCard||"",labourCardPersonalNo:l.labourCardPersonalNo||"",period:l.period||"",allowance:l.allowance||"",deduction:l.deduction||"",mess:l.mess||"",advance:l.advance||"",net:l.net||"",remark:l.remark||""},validationSchema:P,onSubmit:async(s,{setSubmitting:o,setErrors:r,resetForm:m})=>{var i,p;try{await N(s,o)}catch(t){o(!1),(p=(i=t.response)==null?void 0:i.data)!=null&&p.errors&&r(t.response.data.errors),console.error("Form submission error:",t)}},enableReinitialize:!0,children:({values:s,touched:o,errors:r,isSubmitting:m,setFieldValue:i,handleBlur:p,resetForm:t})=>e.jsx(K,{children:e.jsxs(B,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Employee Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(n,{label:"EMPLOYEE",invalid:!!r.employee,errorMessage:r.employee,children:e.jsx(V,{name:"employee",placeholder:"Select user",value:v.find(a=>a.value===s.employee),options:v,onChange:a=>{i("employee",(a==null?void 0:a.value)||"")},onBlur:p})}),e.jsx(n,{label:"LABOUR CARD",invalid:!!r.labourCard,errorMessage:r.labourCard,children:e.jsx(u,{name:"labourCard",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"LabourCard",...a})})}),e.jsx(n,{label:"LABOUR CARD PERSONAL NO",invalid:!!r.labourCardPersonalNo,errorMessage:r.labourCardPersonalNo,children:e.jsx(u,{name:"labourCardPersonalNo",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Labour Card PersonalNo",...a})})}),e.jsx(n,{label:"PERIOD",invalid:!!r.period,errorMessage:r.period,children:e.jsx(u,{name:"period",children:({field:a})=>e.jsx(h,{autoComplete:"off",placeholder:"e.g. January 2023",...a})})})]})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Salary Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Allowance",invalid:!!r.allowance&&o.allowance,errorMessage:r.allowance,children:e.jsx(u,{name:"allowance",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Allowance",...a})})}),e.jsx(n,{label:"Deduction",invalid:!!r.deduction&&o.deduction,errorMessage:r.deduction,children:e.jsx(u,{name:"deduction",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Deduction",...a})})}),e.jsx(n,{label:"Mess",invalid:!!r.mess&&o.mess,errorMessage:r.mess,children:e.jsx(u,{name:"mess",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Mess",...a})})}),e.jsx(n,{label:"Advance",invalid:!!r.advance&&o.advance,errorMessage:r.advance,children:e.jsx(u,{name:"advance",children:({field:a,form:y})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Advance",...a})})}),e.jsx(n,{label:"Net",invalid:!!r.net&&o.net,errorMessage:r.net,children:e.jsx(u,{name:"net",children:({field:a})=>e.jsx(h,{type:"text",autoComplete:"off",placeholder:"Net",...a})})})]})]}),e.jsxs(E,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Remarks"}),e.jsx(n,{label:"REMARK",invalid:!!r.remark&&o.remark,errorMessage:r.remark,children:e.jsx(u,{name:"remark",children:({field:a})=>e.jsx(h,{as:"textarea",autoComplete:"off",placeholder:"Enter remarks",...a})})})]})]})}),e.jsxs(z,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:g==="edit"&&j&&e.jsx(S,{size:"sm",variant:"plain",color:"red",icon:e.jsx(_,{}),type:"button",onClick:()=>j(a=>{a&&t()}),children:"Delete"})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(S,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>{t(),x==null||x()},children:"Discard"}),e.jsx(S,{size:"sm",variant:"solid",loading:m,icon:e.jsx(T,{}),type:"submit",children:"Save"})]})]})]})})})});q.displayName="PayrollForm";const R={name:"",labourCard:"",labourCardPersonalNo:"",period:"",allowance:"",deduction:"",mess:"",advance:"",net:"",remark:""},Qe=()=>{const f=O(),{id:d}=L(),[g,l]=b.useState(R),[N,x]=b.useState(!!d),[j,v]=b.useState(null);b.useEffect(()=>{if(!d){l(R),x(!1);return}(async()=>{try{x(!0);const o=await I(d);if(!(o!=null&&o.data))throw new Error("Invalid payroll data received");const{employee:r,labourCard:m,labourCardPersonalNo:i,period:p,allowance:t,deduction:a,mess:y,advance:F,net:A,remark:M}=o.data;l({employee:(r==null?void 0:r._id)||"",labourCard:m||"",labourCardPersonalNo:i||"",period:p||"",allowance:t||"",deduction:a||"",mess:y||"",advance:F||"",net:A||"",remark:M||""}),v(null)}catch(o){console.error("Error fetching payroll report:",o),v(o.message||"Failed to load payroll data"),k.push(e.jsx(C,{title:"Failed to fetch payroll report data",type:"danger",duration:2500,children:o.message||"Something went wrong"}),{placement:"top-center"}),setTimeout(()=>f("/app/payroll-view"),2500)}finally{x(!1)}})()},[d,f]);const w=async(s,o)=>{var r,m,i,p;try{o(!0);const t={employee:s.employee,labourCard:s.labourCard,labourCardPersonalNo:s.labourCardPersonalNo,period:s.period,allowance:s.allowance,deduction:s.deduction,mess:s.mess,advance:s.advance,net:s.net,remark:s.remark},a=d?await U(d,t):await $(t);if([200,201].includes(a.status))k.push(e.jsxs(C,{title:`Successfully ${d?"updated":"added"} payroll report`,type:"success",duration:2500,children:["Payroll report ",d?"updated":"added"," successfully"]}),{placement:"top-center"}),f("/app/payroll-report-view");else throw new Error(((m=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:m.message)||"Unexpected status code")}catch(t){console.error("Form submission error:",t),k.push(e.jsx(C,{title:`Error ${d?"updating":"adding"} payroll report`,type:"danger",duration:2500,children:((p=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:p.message)||t.message}),{placement:"top-center"})}finally{o(!1)}},P=()=>{JSON.stringify(g)!==JSON.stringify(R)?window.confirm("Are you sure you want to discard changes?")&&f("/app/payroll-view"):f("/app/payroll-view")};return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(C,{title:"Error loading payroll report",type:"danger",children:j})}):e.jsx(q,{type:d?"edit":"new",initialData:g,onFormSubmit:w,onDiscard:P})};export{Qe as default};
