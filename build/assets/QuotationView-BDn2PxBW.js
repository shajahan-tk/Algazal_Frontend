import{j as e,ak as Y,r as d,u as q,v as Q,a4 as y,b as x}from"./index-B-3YdMmO.js";import{a as R,C as _}from"./Views-o_SZwizf.js";import{C as k}from"./Card-Dg6B2cp2.js";import{B as h}from"./Button-CfVbO-qU.js";import{L as H}from"./Logo-C6RBJ_pF.js";import{T as w}from"./index-CqQ94ycg.js";import{u as B,a as I,c as L,f as b}from"./index-BYLbIXHY.js";import{N as V}from"./react-number-format.es-8ESNe4IM.js";import{aG as $,a6 as U,a2 as O}from"./index-C7R1WpOH.js";import{u as W}from"./useThemeClass-BEUnEzZK.js";import{g as G,d as X}from"./api-Dpl5zWZX.js";import"./Alert-QJLDMk5I.js";import"./index-Bo39LFtR.js";import"./Badge-B2PjptLi.js";import"./index-DCFjNNBJ.js";import"./Skeleton-C9LsrBBE.js";import"./Dialog-DSC5KQx1.js";import"./Drawer-CIBw5hlm.js";import"./index-DVAakj00.js";import"./FormItem-B_dHMuui.js";import"./useUniqueId-bhrNi0MA.js";import"./Input-m_H_R88b.js";import"./index-B_Yvn3dy.js";import"./index-Z4dDP0Pn.js";import{t as v,N as D}from"./toast-xjy4rp4Y.js";import"./index-BdrlLZgj.js";import"./index-5z68-iaN.js";import"./ScrollBar-C_iOIJGq.js";import"./Select-DPSULLBa.js";import"./Upload-CuAXzTtV.js";import"./Tag-D_vNYl-M.js";import"./context-_TTgW2bZ.js";import"./index-BLqgq88H.js";import"./StatusIcon-IxYTyNOx.js";import"./CloseButton-8arYtbYT.js";import"./proxy-nPFZIZ0Z.js";import"./floating-ui.react-l_cC_yYr.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-Dhg3PmVb.js";import"./useControllableState-HmMJSzbR.js";import"./_getPrototype-BJeMep-l.js";import"./index-BL9xzUQn.js";import"./toString-B2j7ZGf1.js";import"./chainedFunction-BxZSneMW.js";import"./index-CYY49BFP.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-VlwWE1Gk.js";const{Tr:m,Th:z,Td:l,THead:J,TBody:K,TFoot:Z}=w,P=({label:o,value:r})=>e.jsxs(m,{children:[e.jsx(l,{className:"!border-t-0",colSpan:4}),e.jsx(l,{className:"font-semibold !border-t-0 text-right",children:o}),e.jsx(l,{className:"!py-3 !border-t-0",children:e.jsx(p,{amount:r})})]}),p=({amount:o=0})=>e.jsx(V,{displayType:"text",value:(Math.round(o*100)/100).toFixed(2),suffix:" AED",thousandSeparator:!0}),n=L(),ee=[n.accessor("sno",{header:"S.No",cell:o=>o.getValue()}),n.accessor("description",{header:"Description"}),n.accessor("uom",{header:"U.O.M"}),n.accessor("qty",{header:"Qty"}),n.accessor("unitPrice",{header:"Unit Price (AED)",cell:o=>e.jsx(p,{amount:o.getValue()})}),n.accessor("total",{header:"Total (AED)",cell:o=>e.jsx(p,{amount:o.getValue()})})],te=({products:o=[],summary:r={}})=>{const c=B({data:o,columns:ee,getCoreRowModel:I()});return e.jsxs(w,{children:[e.jsx(J,{children:c.getHeaderGroups().map(i=>e.jsx(m,{children:i.headers.map(t=>e.jsx(z,{colSpan:t.colSpan,children:b(t.column.columnDef.header,t.getContext())},t.id))},i.id))}),e.jsx(K,{children:c.getRowModel().rows.map(i=>e.jsx(m,{children:i.getVisibleCells().map(t=>e.jsx(l,{children:b(t.column.columnDef.cell,t.getContext())},t.id))},i.id))}),e.jsxs(Z,{children:[e.jsx(P,{label:"Total (AED)",value:r.subTotal}),e.jsx(P,{label:"VAT 5% (AED)",value:r.vat}),e.jsxs(m,{children:[e.jsx(l,{className:"!border-t-0",colSpan:4}),e.jsx(l,{className:"font-semibold text-base text-right",children:"Net Amount (AED)"}),e.jsx(l,{className:"font-semibold text-base !py-3",children:e.jsx(p,{amount:r.netAmount})})]})]})]})},se=()=>{const{textTheme:o}=W(),{projectId:r}=Y(),[c,i]=d.useState(!0),[t,T]=d.useState(null);console.log(t," 12q123132");const C=q(s=>s.theme.mode),[j,u]=d.useState(null),[f,N]=d.useState(!1),M=Q();if(d.useEffect(()=>{(async()=>{try{if(i(!0),!r)throw new Error("Project ID is missing");const a=await G(r);T(a.data)}catch(a){console.error("Error fetching quotation:",a),u("Failed to load quotation data")}finally{i(!1)}})()},[r]),j)return e.jsxs("div",{className:"p-4 text-center text-red-500",children:[j,e.jsx(h,{className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]});if(!t)return e.jsx(y,{loading:c});const A=t.items.map((s,a)=>{var g;return{id:s._id,sno:a+1,description:s.description,uom:s.uom,qty:s.quantity,unitPrice:s.unitPrice,total:s.totalPrice,details:{image:(g=s.image)==null?void 0:g.url}}}),E={subTotal:t.subtotal,vat:t.vatAmount,netAmount:t.netAmount},S=async()=>{if(t){N(!0),u("");try{await X(t._id,t.quotationNumber),v.push(e.jsx(D,{title:"Success",type:"success",children:"PDF downloaded successfully"}))}catch(s){u("Failed to download PDF"),v.push(e.jsx(D,{title:"Error",type:"danger",children:s.message||"Failed to download PDF"}))}finally{N(!1)}}},F=s=>{M(`${R}/quotation-edit/${s.project._id}/${s._id}`,{state:{estimationId:s==null?void 0:s.estimation,quotationId:s==null?void 0:s._id}}),console.log("handleEdit called with:",s),console.log("project ID:",s.project._id),console.log("quotation ID:",s._id)};return e.jsxs(y,{loading:c,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-10",children:[e.jsxs("div",{children:[e.jsx(H,{className:"mb-3",mode:C}),e.jsx("address",{className:"not-italic",children:e.jsxs("div",{children:[e.jsx("h5",{children:t.project.projectName}),e.jsx("br",{})]})})]}),e.jsxs("div",{className:"my-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("h4",{children:["Quotation ",t.quotationNumber]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{children:["Date: ",x(t.date).format("dddd, DD MMMM, YYYY")]}),e.jsxs("span",{children:["Valid Until: ",x(t.validUntil).format("dddd, DD MMMM, YYYY")]})]})]}),e.jsxs("div",{className:"mt-4 flex",children:[e.jsx($,{className:`text-xl ${o}`}),e.jsxs("div",{className:"ltr:ml-3 rtl:mr-3",children:["Prepared By: ",t.preparedBy.firstName," ",t.preparedBy.lastName]})]}),e.jsxs("div",{className:"mt-4 flex",children:[e.jsx(U,{className:`text-xl ${o}`}),e.jsx("div",{className:"ltr:ml-3 rtl:mr-3",children:e.jsxs("h6",{children:["Project: ",t.project.projectName]})})]})]})]}),e.jsx(te,{products:A,summary:E,vatPercentage:t.vatPercentage}),t.scopeOfWork.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h5",{className:"mb-3",children:"Scope of Work:"}),e.jsx("ul",{className:"list-disc pl-5 space-y-2",children:t.scopeOfWork.map((s,a)=>e.jsx("li",{children:s},`scope-${a}`))})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h5",{className:"mb-3",children:"Terms & Conditions:"}),e.jsx("ol",{className:"list-decimal pl-5 space-y-2",children:t.termsAndConditions.map((s,a)=>e.jsx("li",{children:s},`term-${a}`))})]}),e.jsxs("div",{className:"print:hidden mt-6 flex items-center justify-between",children:[e.jsxs("small",{className:"italic",children:["Quotation is valid until ",x(t.validUntil).format("DD MMMM, YYYY")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"solid",loading:f,onClick:S,children:f?"Generating PDF...":"Download PDF"}),e.jsx(h,{variant:"solid",icon:e.jsx(O,{}),onClick:()=>F(t),children:"Edit"})]})]})]})},Je=()=>e.jsx(_,{className:"h-full",children:e.jsx(k,{className:"h-full",bodyClass:"h-full",children:e.jsx(se,{})})});export{Je as default};
