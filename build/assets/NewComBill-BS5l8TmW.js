import{r as b,j as e,v as A,ak as T}from"./index-CDUqAS1l.js";import{N as g,t as w}from"./toast-DGerJIJB.js";import{F as B,a as x}from"./FormItem-ByEmqHQ5.js";import{B as C}from"./Button-BPBskG9o.js";import{S as E}from"./StickyFooter-DBlfAIlK.js";import{F as I,a as O,b as j}from"./formik.esm-D7-nrDq7.js";import{A as k}from"./index-CwCYPHLJ.js";import{$ as q}from"./index-BerpkDBA.js";import{c as R,b as S,g as V}from"./index.esm-OMRqgHjV.js";import"./Alert-DL8X4Uab.js";import"./index-C1Nx0TEh.js";import"./Badge-hMcflglf.js";import{D as $}from"./index-CRkWz9hY.js";import"./Card-Bb8Omztx.js";import"./Skeleton-DoyxclK2.js";import"./Dialog-C7AMlNhG.js";import"./Drawer-peSRAyXS.js";import"./index-DvFxqpjx.js";import"./useUniqueId-CQBDBfVD.js";import{I as z}from"./Input-DXBk0KXn.js";import"./index-Dk4smkVo.js";import"./index-cjDbE1Ce.js";import"./index-DQYmJabE.js";import"./index-ChKfPKLA.js";import"./ScrollBar-QR2Zwrhq.js";import{S as F}from"./Select-Bc7Wf5rB.js";import"./Upload-BJb1fzL_.js";import"./index-CocX0oO3.js";import"./Tag-Bq5dzNE2.js";import{A as P}from"./AdaptableCard-BXZ7gMWR.js";import"./Views-DmS3tele.js";import"./chart.config-CZuakYno.js";import{C as H}from"./ConfirmDialog-C7odLSAF.js";import"./DataTable-CVcq30BR.js";import"./SvgIcon-DCpuHJM3.js";import"./SegmentItemOption-CD7-Nqsw.js";import{f as J}from"./format-CBpsKyOP.js";import{o as L,p as Q,q as U}from"./api-DQdmRQDg.js";import"./StatusIcon-twe9Eqr7.js";import"./CloseButton-BXRa_ZJ2.js";import"./chainedFunction-BxZSneMW.js";import"./proxy-Dk6QltiT.js";import"./context-D-kJGxG9.js";import"./index-CJy_8sJq.js";import"./cloneDeep-DJN0yfLA.js";import"./hoist-non-react-statics.cjs-BmYztAKh.js";import"./floating-ui.react-CCBWD0pR.js";import"./floating-ui.dom-B_iSk-nO.js";import"./useControllableState-DyX12gyY.js";import"./_getPrototype-CIMlDKAv.js";import"./index-CjDcj2AV.js";import"./toString-DOI2nrr_.js";import"./index-DlSvysZf.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./index-CBdLSIrO.js";import"./index-B2bfEVVx.js";import"./useThemeClass-5GKJG2gx.js";const Y=new Date,N=[{label:"ADVANCE",value:"advance"},{label:"ADIB",value:"adib"},{label:"Cash",value:"cash"},{label:"MASHREQ CARD",value:"masherq_card"}],M=b.forwardRef((r,s)=>{const{type:l,initialData:n={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:"",paymentMethod:"cash"},onFormSubmit:c,onDiscard:p,onDelete:y}=r,f=R().shape({billDate:S().required("Date is required"),amount:V().typeError("Amount must be a number").required("Amount is required"),paymentMethod:S().required("Payment method is required")});return e.jsx(I,{innerRef:s,initialValues:{...n,billType:n.billType||"commission",billDate:n.billDate||new Date().toISOString().split("T")[0],amount:n.amount??"",paymentMethod:n.paymentMethod||"cash"},validationSchema:f,onSubmit:async(u,{setSubmitting:h})=>{const i=new FormData;i.append("billType",u.billType),i.append("billDate",u.billDate),i.append("amount",u.amount.toString()),i.append("paymentMethod",u.paymentMethod),await c(i,h)},enableReinitialize:!0,children:({values:u,touched:h,errors:i,isSubmitting:a,setFieldValue:v})=>e.jsx(O,{children:e.jsxs(B,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(P,{divider:!0,className:"mb-4",children:[e.jsx("h5",{className:"mb-4",children:"Commission Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Bill Type",children:e.jsx(j,{name:"billType",children:({field:o,form:m})=>e.jsx(F,{options:[{label:"Commission",value:"commission"}],value:{label:"Commission",value:"commission"},onChange:t=>m.setFieldValue(o.name,t==null?void 0:t.value),isDisabled:l==="edit"})})}),e.jsx(x,{label:"Date",invalid:!!i.billDate&&h.billDate,children:e.jsx(j,{name:"billDate",children:({field:o,form:m})=>e.jsx($,{placeholder:"Select Date",value:o.value?new Date(o.value):null,maxDate:Y,onChange:t=>m.setFieldValue(o.name,t?J(new Date(t.getFullYear(),t.getMonth(),t.getDate()),"yyyy-MM-dd"):"")})})}),e.jsx(x,{label:"Amount",invalid:!!i.amount&&h.amount,errorMessage:i.amount,children:e.jsx(j,{name:"amount",children:({field:o,form:m})=>e.jsx(z,{type:"number",autoComplete:"off",placeholder:"Amount",...o,onChange:t=>m.setFieldValue(o.name,t.target.value)})})}),e.jsx(x,{label:"Payment Method",invalid:!!i.paymentMethod&&h.paymentMethod,errorMessage:i.paymentMethod,children:e.jsx(j,{name:"paymentMethod",children:({field:o,form:m})=>e.jsx(F,{options:N,value:N.find(t=>t.value===o.value),onChange:t=>m.setFieldValue(o.name,t==null?void 0:t.value)})})})]})]})})}),e.jsxs(E,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:l==="edit"&&y&&e.jsx(_,{onDelete:y})}),e.jsxs("div",{className:"md:flex items-center",children:[e.jsx(C,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:()=>p==null?void 0:p(),children:"Discard"}),e.jsx(C,{size:"sm",variant:"solid",loading:a,icon:e.jsx(k,{}),type:"submit",children:"Save"})]})]})]})})})});M.displayName="CommissionBillForm";const _=({onDelete:r})=>{const[s,l]=b.useState(!1),n=()=>{l(!1),r==null||r(l)},c=()=>{l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"text-red-600",variant:"plain",size:"sm",icon:e.jsx(q,{}),type:"button",onClick:()=>l(!0),children:"Delete"}),e.jsx(H,{isOpen:s,type:"danger",title:"Delete Commission Entry",confirmButtonColor:"red-600",onClose:c,onRequestClose:c,onCancel:c,onConfirm:n,children:e.jsx("p",{children:"Are you sure you want to delete this commission entry?"})})]})},D={billType:"commission",billDate:new Date().toISOString().split("T")[0],amount:""},Ze=()=>{const r=A(),{id:s}=T(),[l,n]=b.useState(D),[c,p]=b.useState(!!s),[y,f]=b.useState(null);b.useEffect(()=>{if(!s){n(D),p(!1);return}(async()=>{try{p(!0);const a=await L(s);if(!(a!=null&&a.data))throw new Error("Invalid bill data received");n({billType:a.data.billType||"commission",billDate:a.data.billDate||D.billDate,amount:a.data.amount||""}),f(null)}catch(a){console.error("Error fetching bill:",a),f(a.message||"Failed to load bill data"),w.push(e.jsx(g,{title:"Failed to fetch commission data",type:"danger",duration:2500,children:a.message||"Something went wrong"}),{placement:"top-center"}),setTimeout(()=>r("/app/commission-bill-view"),2500)}finally{p(!1)}})()},[s,r]);const u=async(i,a)=>{var v,o,m,t;try{a(!0);const d=s?await Q(s,i):await U(i);if([200,201].includes(d.status))w.push(e.jsxs(g,{title:`Successfully ${s?"updated":"added"} commission bill`,type:"success",duration:2500,children:["Commission bill ",s?"updated":"added"," successfully"]}),{placement:"top-center"}),r("/app/commission-bill-view");else throw new Error(((o=(v=d==null?void 0:d.response)==null?void 0:v.data)==null?void 0:o.message)||"Unexpected status code")}catch(d){console.error("Error during form submission:",d),w.push(e.jsx(g,{title:`Error ${s?"updating":"adding"} commission bill`,type:"danger",duration:2500,children:((t=(m=d==null?void 0:d.response)==null?void 0:m.data)==null?void 0:t.message)||d.message}),{placement:"top-center"})}finally{a(!1)}},h=()=>{JSON.stringify(l)!==JSON.stringify(D)?window.confirm("Are you sure you want to discard changes?")&&r("/app/commission-bill-view"):r("/app/commission-bill-view")};return c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):y?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(g,{title:"Error loading commission",type:"danger",children:y})}):e.jsx(M,{type:s?"edit":"new",initialData:l,onFormSubmit:u,onDiscard:h})};export{Ze as default};
