import{ak as O,v as H,r as l,j as e}from"./index-CfFwh--H.js";import"./Alert-8oOn-LBQ.js";import"./index-CSFznbuf.js";import"./Badge-Bo_BJ3HY.js";import{B as L}from"./Button-DK8YG6Vd.js";import"./index-Tb9TnHR2.js";import"./Card-DrR7Wowt.js";import"./Skeleton-CkbmhpF1.js";import"./Dialog-CCGqt-e6.js";import"./Drawer-rdVC219j.js";import"./index-Cqj_MPfk.js";import"./FormItem-CrM3E5oZ.js";import"./useUniqueId-C3QGMlyo.js";import"./Input-CT3ndZ0a.js";import"./index-e68N8ix-.js";import"./index-DuV_W8Ok.js";import{t as c,N as n}from"./toast-CZz_7xZu.js";import"./index-BhqUyqjr.js";import"./index-DbLmEKzF.js";import"./ScrollBar-BGjE3Qe3.js";import"./Select-DXgitA5g.js";import"./Upload-C3hi9liu.js";import"./index-uPavB4wA.js";import"./Tag-CDky4RgO.js";import{aT as V,aU as Q,$ as R,aV as W}from"./index-CEOENyZN.js";import{f as z,d as G,a as J}from"./api-hMw0Wzsw.js";import"./StatusIcon-CVY_iJbr.js";import"./CloseButton-BXsrAn2U.js";import"./proxy-DVFC3BrG.js";import"./floating-ui.react-DGPs_AnH.js";import"./floating-ui.dom-B_iSk-nO.js";import"./index-CbqZmROt.js";import"./context-ClB8cHxu.js";import"./useControllableState-e9pFJmGN.js";import"./Views-DDo_d-60.js";import"./_getPrototype-QbS_EcaU.js";import"./index-C6dvUS2c.js";import"./toString-tgkm5ft3.js";import"./chainedFunction-BxZSneMW.js";import"./index-DYO9xx5Q.js";import"./defineProperty-DRmM3rRU.js";import"./typeof-QjJsDpFa.js";import"./hoist-non-react-statics.cjs-ByyYtpKF.js";import"./index-LGebAmfn.js";const qe=()=>{var k,b,f,w,v;const{expenseId:r}=O(),i=H(),[a,_]=l.useState(null),[$,y]=l.useState(!0),[T,h]=l.useState(!1),[B,u]=l.useState(!1);l.useEffect(()=>{(async()=>{try{y(!0);const s=await z(r);_(s.data),console.log("resmaterials",s.data.materials)}catch(s){c.push(e.jsx(n,{title:"Error",type:"danger",children:"Failed to load expense details"})),console.error("Error loading expense:",s),i(-1)}finally{y(!1)}})()},[r,i]);const I=async()=>{try{h(!0),await J(r),c.push(e.jsx(n,{title:"Success",type:"success",children:"Expense deleted successfully"})),i(`/projects/${a==null?void 0:a.project._id}/expenses`)}catch(t){c.push(e.jsx(n,{title:"Error",type:"danger",children:"Failed to delete expense"})),console.error("Error deleting expense:",t)}finally{h(!1)}},U=async()=>{try{u(!0);const t=`expense-${a==null?void 0:a.project.projectNumber}-${r}.pdf`;await G(r,t)}catch(t){c.push(e.jsx(n,{title:"Error",type:"danger",children:"Failed to download PDF"})),console.error("Error downloading PDF:",t)}finally{u(!1)}},o=t=>t?(typeof t=="string"?new Date(t):t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";if($)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 dark:border-blue-400"})});if(!a)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Expense not found"})});const p=a.totalMaterialCost||0,g=a.totalMiscellaneousCost||0,m=((k=a.laborDetails)==null?void 0:k.totalLaborCost)||0,j=p+g+m,x=((b=a.quotation)==null?void 0:b.netAmount)||0,N=a.commissionAmount||0,d=x-j-N,q=x?d/x*100:0;return e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("button",{onClick:()=>i(-1),className:"flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(V,{className:"mr-1"}),"Back"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(L,{variant:"solid",icon:e.jsx(Q,{}),loading:B,onClick:U,children:"Download PDF"}),e.jsx(L,{variant:"plain",icon:e.jsx(R,{}),loading:T,onClick:I,className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:["Expense Details - ",a.project.projectName," (",a.project.projectNumber,")"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created By"}),e.jsxs("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:[a.createdBy.firstName," ",a.createdBy.lastName]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created On"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:o(a.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Updated"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 font-medium",children:o(a.updatedAt)})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Material Expenses"}),((f=a.materials)==null?void 0:f.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Invoice No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount (AED)"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Supplier"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Document"})]})}),e.jsxs("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[a.materials.map((t,s)=>{var D,E,A,F,C,S,P,M;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-4 whitespace-normal text-sm text-gray-900 dark:text-gray-100",children:((D=t==null?void 0:t._doc)==null?void 0:D.description)||"N/A"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:o((E=t==null?void 0:t._doc)==null?void 0:E.date)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:((A=t==null?void 0:t._doc)==null?void 0:A.invoiceNo)||"N/A"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:((C=(F=t==null?void 0:t._doc)==null?void 0:F.amount)==null?void 0:C.toFixed(2))||"0.00"}),e.jsx("td",{className:"px-4 py-4 whitespace-normal text-sm text-gray-500 dark:text-gray-400",children:((S=t==null?void 0:t._doc)==null?void 0:S.supplierName)||"N/A"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:(P=t==null?void 0:t._doc)!=null&&P.documentUrl?e.jsxs("a",{href:(M=t==null?void 0:t._doc)==null?void 0:M.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(W,{className:"mr-1"}),"View"]}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"No document"})})]},s)}),e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 font-semibold",children:[e.jsx("td",{colSpan:3,className:"px-4 py-4 text-right text-sm text-gray-900 dark:text-gray-100",children:"Total Material Cost:"}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[p.toFixed(2)," AED"]}),e.jsx("td",{colSpan:2})]})]})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No material expenses recorded"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Miscellaneous Expenses"}),((w=a.miscellaneous)==null?void 0:w.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"})]})}),e.jsxs("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[a.miscellaneous.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-gray-900 dark:text-gray-100",children:t.description}),e.jsx("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:t.quantity}),e.jsxs("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:[t.unitPrice.toFixed(2)," AED"]}),e.jsxs("td",{className:"px-6 py-4 text-gray-500 dark:text-gray-400",children:[t.total.toFixed(2)," AED"]})]},s)),e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-700 font-semibold",children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-gray-900 dark:text-gray-100",children:"Total Miscellaneous Cost:"}),e.jsxs("td",{className:"px-6 py-4 text-gray-900 dark:text-gray-100",children:[g.toFixed(2)," AED"]})]})]})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No miscellaneous expenses recorded"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Labor Details"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-900 dark:text-gray-100",children:"Workers"}),((v=a.laborDetails.workers)==null?void 0:v.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Days"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Daily Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:a.laborDetails.workers.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.user.profileImage&&e.jsx("img",{className:"h-10 w-10 rounded-full mr-3",src:t.user.profileImage,alt:`${t.user.firstName} ${t.user.lastName}`}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-900 dark:text-gray-100",children:[t.user.firstName," ",t.user.lastName]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:t.daysPresent}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[t.dailySalary.toFixed(2)," AED"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[t.totalSalary.toFixed(2)," AED"]})]},t._id))})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No workers assigned"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-900 dark:text-gray-100",children:"Driver"}),a.laborDetails.driver?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Days"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Daily Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[a.laborDetails.driver.user.profileImage&&e.jsx("img",{className:"h-10 w-10 rounded-full mr-3",src:a.laborDetails.driver.user.profileImage,alt:`${a.laborDetails.driver.user.firstName} ${a.laborDetails.driver.user.lastName}`}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-900 dark:text-gray-100",children:[a.laborDetails.driver.user.firstName," ",a.laborDetails.driver.user.lastName]})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:a.laborDetails.driver.daysPresent}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[a.laborDetails.driver.dailySalary.toFixed(2)," AED"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500 dark:text-gray-400",children:[a.laborDetails.driver.totalSalary.toFixed(2)," AED"]})]})})]})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No driver assigned"})]}),e.jsx("div",{className:"mt-6 bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:"Total Labor Cost:"}),e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:[m.toFixed(2)," AED"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-gray-100",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Material Costs"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:[p.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Miscellaneous Costs"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-800 dark:text-purple-200",children:[g.toFixed(2)," AED"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Labor Costs"}),e.jsxs("p",{className:"text-2xl font-bold text-green-800 dark:text-green-200",children:[m.toFixed(2)," AED"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-indigo-600 dark:text-indigo-400",children:"Total Expenses"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-800 dark:text-indigo-200",children:[j.toFixed(2)," AED"]})]}),a.quotation&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Quotation Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-800 dark:text-yellow-200",children:[x.toFixed(2)," AED"]})]})]}),a.quotation&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Commission"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-800 dark:text-orange-200",children:[N.toFixed(2)," AED"]})]}),e.jsxs("div",{className:`p-4 rounded-lg ${d>=0?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"}`,children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[d>=0?"Net Profit":"Net Loss"," (After Commission)"]}),e.jsxs("p",{className:`text-2xl font-bold ${d>=0?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"}`,children:[Math.abs(d).toFixed(2)," AED (",q.toFixed(2),"%)"]})]})]})]})]})};export{qe as default};
